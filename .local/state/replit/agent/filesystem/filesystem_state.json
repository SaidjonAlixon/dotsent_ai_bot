{"file_contents":{"main.py":{"content":"import asyncio\nimport logging\nfrom aiogram import Bot, Dispatcher\nfrom aiogram.fsm.storage.memory import MemoryStorage\nfrom aiogram.types import Message, CallbackQuery\nfrom aiogram import BaseMiddleware\nfrom typing import Callable, Dict, Any, Awaitable\n\nfrom config import BOT_TOKEN\nimport config\nfrom database import Database\nfrom handlers import user_handlers, admin_handlers\nfrom keyboards import get_support_buttons\n\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'\n)\n\nlogger = logging.getLogger(__name__)\n\nclass BanCheckMiddleware(BaseMiddleware):\n    \"\"\"Cheklangan foydalanuvchilarni bloklash middleware\"\"\"\n    \n    def __init__(self):\n        super().__init__()\n        self.db = Database()\n    \n    async def __call__(\n        self,\n        handler: Callable[[Message, Dict[str, Any]], Awaitable[Any]],\n        event: Message | CallbackQuery,\n        data: Dict[str, Any]\n    ) -> Any:\n        # Admin uchun tekshirmaslik\n        user_id = event.from_user.id\n        if user_id == config.ADMIN_ID:\n            return await handler(event, data)\n        \n        # /start buyrug'ini o'tkazib yuborish (u o'zida tekshiradi)\n        if isinstance(event, Message) and event.text and event.text.startswith('/start'):\n            return await handler(event, data)\n        \n        # Foydalanuvchi cheklangan yoki yo'qligini tekshirish\n        if self.db.is_user_banned(user_id):\n            if isinstance(event, Message):\n                await event.answer(\n                    \"ğŸš« **Sizning botdan foydalanish huquqingiz yo'q.**\\n\\n\"\n                    \"Agar bu xato deb hisoblasangiz yoki huquqni qaytadan olish uchun \"\n                    \"qo'llab-quvvatlash guruhiga murojaat qiling:\",\n                    reply_markup=get_support_buttons(config.SUPPORT_GROUP_URL),\n                    parse_mode=\"Markdown\"\n                )\n            elif isinstance(event, CallbackQuery):\n                await event.answer(\n                    \"ğŸš« Sizning botdan foydalanish huquqingiz yo'q.\",\n                    show_alert=True\n                )\n            return\n        \n        # Foydalanuvchi cheklanmagan - davom etish\n        return await handler(event, data)\n\nasync def main():\n    \"\"\"Bot ishga tushirish\"\"\"\n    \n    if not BOT_TOKEN:\n        logger.error(\"BOT_TOKEN topilmadi! .env faylini to'ldiring.\")\n        return\n    \n    logger.info(\"Bot ishga tushmoqda...\")\n    \n    db = Database()\n    logger.info(\"Ma'lumotlar bazasi tayyor\")\n    \n    bot = Bot(token=BOT_TOKEN)\n    dp = Dispatcher(storage=MemoryStorage())\n    \n    # Middleware qo'shish - barcha user handlerlar uchun\n    user_handlers.router.message.middleware(BanCheckMiddleware())\n    user_handlers.router.callback_query.middleware(BanCheckMiddleware())\n    \n    dp.include_router(user_handlers.router)\n    dp.include_router(admin_handlers.router)\n    \n    logger.info(\"Bot ishga tushdi!\")\n    \n    await dp.start_polling(bot)\n\nif __name__ == \"__main__\":\n    try:\n        asyncio.run(main())\n    except KeyboardInterrupt:\n        logger.info(\"Bot to'xtatildi\")\n","size_bytes":3097},"README.md":{"content":"# Telegram Bot - Kurs Ishi va Maqola Tayyorlash\n\nBu bot foydalanuvchilarga AI yordamida kurs ishi va maqola tayyorlashda yordam beradi.\n\n## Asosiy imkoniyatlar\n\n### Foydalanuvchi uchun:\n- ğŸ§¾ Kurs ishi yozish (AI orqali avtomatik yaratiladi)\n- ğŸ“° Maqola yozish (ilmiy maqola tayyorlash)\n- ğŸ’° Balans tizimi (to'lov va chegirmalar)\n- ğŸ’µ Referal tizimi (do'stlarni taklif qilish orqali pul ishlash)\n- ğŸ Promokod tizimi (chegirmalar)\n- ğŸ‘¤ Profil (shaxsiy ma'lumotlar)\n\n### Admin uchun:\n- ğŸ“¢ Ommaviy xabar yuborish\n- ğŸ’¬ ID orqali xabar yuborish\n- ğŸ’³ Balans boshqarish\n- ğŸ“Š Statistika\n- ğŸ¤ Referal sozlamalari\n- ğŸ’¸ Narxlarni boshqarish\n- ğŸŸ Promokod yaratish\n- âœ… To'lovlarni tasdiqlash\n\n## O'rnatish va sozlash\n\n### 1. Environment o'zgaruvchilarni sozlash\n\n`.env` fayl yarating va quyidagi ma'lumotlarni kiriting:\n\n```env\nBOT_TOKEN=sizning_bot_tokeningiz\nOPENAI_API_KEY=sizning_openai_api_keyingiz\nADMIN_ID=sizning_telegram_id_ingiz\nKURS_ISHLARI_CHANNEL_ID=-100xxxxxxxxx\nMAQOLALAR_CHANNEL_ID=-100xxxxxxxxx\nTOLOV_TASDIQLASH_CHANNEL_ID=-100xxxxxxxxx\n```\n\n### 2. Kanallarni yaratish\n\n1. **Kurs ishlari kanali** - tayyor kurs ishlari bu yerga yuboriladi\n2. **Maqolalar kanali** - tayyor maqolalar bu yerga yuboriladi\n3. **To'lov tasdiqlash kanali** - to'lov cheklari bu yerga yuboriladi\n\nHar bir kanalga botni admin qilib qo'shing.\n\n### 3. Kanal ID larini olish\n\nKanalga biror xabar yuboring, keyin quyidagi URLga kiring:\n```\nhttps://api.telegram.org/bot<BOT_TOKEN>/getUpdates\n```\n\nNatijada kanal ID sini ko'rasiz (masalan: -1001234567890)\n\n### 4. Admin ID ni olish\n\n[@userinfobot](https://t.me/userinfobot) botiga `/start` yuboring va o'z ID ingizni oling.\n\n### 5. Botni ishga tushirish\n\nBotni ishga tushirish uchun quyidagi buyruqni bajaring:\n\n```bash\npython main.py\n```\n\n## Ma'lumotlar bazasi\n\nBot SQLite dan foydalanadi. Quyidagi jadvallar yaratiladi:\n\n- `users` - foydalanuvchilar\n- `orders` - buyurtmalar (kurs ishlari va maqolalar)\n- `payments` - to'lovlar\n- `promocodes` - promokodlar\n- `settings` - sozlamalar\n\n## Xususiyatlar\n\n### AI integratsiyasi\n\nBot OpenAI GPT-4 modelidan foydalanib professional kurs ishlari va maqolalar yaratadi.\n\n### DOCX formati\n\nBarcha ishlar DOCX formatda tayyorlanadi va quyidagi formatga ega:\n- Shrift: Times New Roman\n- Hajmi: 14pt\n- Interval: 1.5\n\n### To'lov tizimi\n\nAdmin tomonidan qo'lda tasdiqlash orqali ishlaydi. Foydalanuvchi to'lov chekini yuboradi, admin tasdiqlaydi va balans avtomatik yangilanadi.\n\n### Referal tizimi\n\nHar bir foydalanuvchi o'zining referal havolasiga ega. Do'stlarni taklif qilganda bonus oladi.\n\n## Texnik ma'lumotlar\n\n- **Til**: Python 3.11\n- **Framework**: Aiogram 3.x\n- **AI**: OpenAI GPT-4\n- **Database**: SQLite\n- **Fayl formati**: DOCX (python-docx)\n\n## Yordam\n\nMuammolar yoki savollar bo'lsa, admin bilan bog'laning.\n","size_bytes":2813},"keyboards.py":{"content":"from aiogram.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton\n\ndef get_main_menu():\n    \"\"\"Asosiy menyu\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"ğŸ§¾ Kurs ishi yozish\"), KeyboardButton(text=\"ğŸ“° Maqola yozish\")],\n            [KeyboardButton(text=\"ğŸ’° Balansim\"), KeyboardButton(text=\"ğŸ’µ Pul ishlash\")],\n            [KeyboardButton(text=\"ğŸ‘¤ Profil\"), KeyboardButton(text=\"ğŸ Promokodlarim\")],\n            [KeyboardButton(text=\"â“ Yordam\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_admin_menu():\n    \"\"\"Admin menyusi\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"ğŸ“¢ Ommaviy xabar\"), KeyboardButton(text=\"ğŸ’¬ ID orqali xabar\")],\n            [KeyboardButton(text=\"ğŸ’³ Balans boshqarish\"), KeyboardButton(text=\"ğŸ“Š Statistika\")],\n            [KeyboardButton(text=\"ğŸ¤ Referal sozlamalari\"), KeyboardButton(text=\"ğŸ’¸ Narxlarni boshqarish\")],\n            [KeyboardButton(text=\"ğŸŸ Promokod yaratish\"), KeyboardButton(text=\"ğŸ“‹ Promokodlar ro'yxati\")],\n            [KeyboardButton(text=\"ğŸš« Foydalanuvchini cheklash\"), KeyboardButton(text=\"âœ… Cheklovni olib tashlash\")],\n            [KeyboardButton(text=\"ğŸ  Foydalanuvchi menyusi\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_cancel_button():\n    \"\"\"Bekor qilish tugmasi\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[[KeyboardButton(text=\"âŒ Bekor qilish\")]],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_skip_button():\n    \"\"\"O'tkazib yuborish tugmasi\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"â­ O'tkazib yuborish\")],\n            [KeyboardButton(text=\"âŒ Bekor qilish\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_payment_confirmation(payment_id: int):\n    \"\"\"To'lovni tasdiqlash tugmalari\"\"\"\n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [\n                InlineKeyboardButton(text=\"âœ… Tasdiqlash\", callback_data=f\"approve_payment_{payment_id}\"),\n                InlineKeyboardButton(text=\"âŒ Rad etish\", callback_data=f\"reject_payment_{payment_id}\")\n            ]\n        ]\n    )\n    return keyboard\n\ndef get_balance_buttons():\n    \"\"\"Balans to'ldirish tugmalari\"\"\"\n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [InlineKeyboardButton(text=\"ğŸ’µ Balansni to'ldirish\", callback_data=\"add_balance\")],\n            [InlineKeyboardButton(text=\"ğŸ”™ Orqaga\", callback_data=\"back_to_menu\")]\n        ]\n    )\n    return keyboard\n\ndef get_work_type_buttons():\n    \"\"\"Ish turi tanlash\"\"\"\n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [InlineKeyboardButton(text=\"ğŸ§¾ Kurs ishi\", callback_data=\"work_type_kurs\")],\n            [InlineKeyboardButton(text=\"ğŸ“° Maqola\", callback_data=\"work_type_maqola\")]\n        ]\n    )\n    return keyboard\n\ndef get_promo_work_type_buttons():\n    \"\"\"Promokod uchun ish turi tanlash\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"ğŸ§¾ Kurs ishi\")],\n            [KeyboardButton(text=\"ğŸ“° Maqola\")],\n            [KeyboardButton(text=\"âŒ Bekor qilish\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_promo_usage_type_buttons():\n    \"\"\"Promokod foydalanish turi\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"ğŸ”„ 1 martalik (1 ta foydalanuvchi)\")],\n            [KeyboardButton(text=\"ğŸ‘¥ Har bir foydalanuvchi uchun 1 marta\")],\n            [KeyboardButton(text=\"â™¾ï¸ Cheksiz foydalanish\")],\n            [KeyboardButton(text=\"âŒ Bekor qilish\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n\ndef get_service_info_buttons(service_type: str, sample_url: str):\n    \"\"\"Xizmat ma'lumoti tugmalari\"\"\"\n    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton\n    \n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [InlineKeyboardButton(text=\"ğŸ“„ Namunani ko'rish\", url=sample_url)],\n            [InlineKeyboardButton(text=\"âœ… Roziman\", callback_data=f\"accept_service_{service_type}\")],\n            [InlineKeyboardButton(text=\"ğŸ”™ Orqaga\", callback_data=\"back_to_menu\")]\n        ]\n    )\n    return keyboard\n\ndef get_support_buttons(support_url: str):\n    \"\"\"Yordam tugmalari\"\"\"\n    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton\n    \n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [InlineKeyboardButton(text=\"ğŸ‘¥ Qo'llab-quvvatlash guruhi\", url=support_url)],\n            [InlineKeyboardButton(text=\"ğŸ”™ Orqaga\", callback_data=\"back_to_menu\")]\n        ]\n    )\n    return keyboard\n\ndef get_pdf_convert_button(file_path: str):\n    \"\"\"PDF ga o'tkazish tugmasi\"\"\"\n    import os\n    # Faqat filename (yo'lsiz) - callback_data 64 baytdan oshmasligi uchun\n    filename = os.path.basename(file_path)\n    keyboard = InlineKeyboardMarkup(\n        inline_keyboard=[\n            [InlineKeyboardButton(text=\"ğŸ“„ Word faylni PDF qilish\", callback_data=f\"pdf:{filename}\")]\n        ]\n    )\n    return keyboard\n\ndef get_payment_amount_buttons():\n    \"\"\"To'lov miqdori tugmalari\"\"\"\n    keyboard = ReplyKeyboardMarkup(\n        keyboard=[\n            [KeyboardButton(text=\"10,000 so'm\"), KeyboardButton(text=\"20,000 so'm\")],\n            [KeyboardButton(text=\"50,000 so'm\"), KeyboardButton(text=\"100,000 so'm\")],\n            [KeyboardButton(text=\"200,000 so'm\"), KeyboardButton(text=\"500,000 so'm\")],\n            [KeyboardButton(text=\"âŒ Bekor qilish\")]\n        ],\n        resize_keyboard=True\n    )\n    return keyboard\n","size_bytes":5726},"handlers/admin_handlers.py":{"content":"from aiogram import Router, F\nfrom aiogram.types import Message, CallbackQuery\nfrom aiogram.filters import Command, StateFilter\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.fsm.state import State, StatesGroup\nfrom datetime import datetime\nimport logging\n\nfrom database import Database\nfrom keyboards import (get_admin_menu, get_main_menu, get_cancel_button, \n                        get_promo_work_type_buttons, get_promo_usage_type_buttons)\nimport config\n\nlogger = logging.getLogger(__name__)\n\nrouter = Router()\ndb = Database()\n\nclass AdminStates(StatesGroup):\n    waiting_for_broadcast_message = State()\n    waiting_for_user_id = State()\n    waiting_for_direct_message = State()\n    waiting_for_balance_user_id = State()\n    waiting_for_balance_amount = State()\n    waiting_for_referal_bonus = State()\n    waiting_for_price_type = State()\n    waiting_for_price_amount = State()\n    waiting_for_promocode_data = State()\n    # Promokod yangi state'lari\n    waiting_for_promo_work_type = State()\n    waiting_for_promo_code = State()\n    waiting_for_promo_discount = State()\n    waiting_for_promo_usage_type = State()\n    # Ban/Unban state'lari\n    waiting_for_ban_user_id = State()\n    waiting_for_unban_user_id = State()\n\ndef is_admin(user_id: int) -> bool:\n    \"\"\"Admin ekanligini tekshirish\"\"\"\n    return user_id == config.ADMIN_ID\n\n@router.message(Command(\"admin\"))\nasync def admin_panel(message: Message):\n    \"\"\"Admin panel\"\"\"\n    if not is_admin(message.from_user.id):\n        await message.answer(\"âŒ Sizda admin huquqlari yo'q.\")\n        return\n    \n    await message.answer(\n        \"ğŸ‘¨â€ğŸ’¼ Admin panel\\n\\nQuyidagi tugmalardan birini tanlang:\",\n        reply_markup=get_admin_menu()\n    )\n\n@router.message(F.text == \"ğŸ“¢ Ommaviy xabar\")\nasync def broadcast_start(message: Message, state: FSMContext):\n    \"\"\"Ommaviy xabar yuborish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"ğŸ“¢ Barcha foydalanuvchilarga yubormoqchi bo'lgan xabaringizni kiriting:\\n\\n\"\n        \"Matn, rasm yoki fayl yuborishingiz mumkin.\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_broadcast_message)\n\n@router.message(AdminStates.waiting_for_broadcast_message)\nasync def broadcast_send(message: Message, state: FSMContext, bot):\n    \"\"\"Ommaviy xabarni yuborish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    users = db.get_all_users()\n    success = 0\n    failed = 0\n    blocked = 0\n    \n    await message.answer(f\"ğŸ“¤ Xabar yuborilmoqda... Jami: {len(users)} foydalanuvchi\")\n    \n    for user_id in users:\n        try:\n            if message.text:\n                await bot.send_message(user_id, message.text)\n            elif message.photo:\n                await bot.send_photo(user_id, message.photo[-1].file_id, caption=message.caption)\n            elif message.document:\n                await bot.send_document(user_id, message.document.file_id, caption=message.caption)\n            success += 1\n            # Agar muvaffaqiyatli yuborilsa, foydalanuvchini faol deb belgilash\n            db.unmark_user_as_blocked(user_id)\n        except Exception as e:\n            error_msg = str(e)\n            logger.error(f\"Xabar yuborishda xatolik (user {user_id}): {e}\")\n            \n            # Agar bot blocked bo'lsa, belgilash\n            if \"bot was blocked\" in error_msg.lower() or \"forbidden\" in error_msg.lower():\n                db.mark_user_as_blocked(user_id)\n                blocked += 1\n            else:\n                failed += 1\n    \n    await message.answer(\n        f\"âœ… Xabar yuborildi!\\n\\n\"\n        f\"âœ… Muvaffaqiyatli: {success}\\n\"\n        f\"ğŸš« Botni blok qilganlar: {blocked}\\n\"\n        f\"âŒ Boshqa xatoliklar: {failed}\",\n        reply_markup=get_admin_menu()\n    )\n    await state.clear()\n\n@router.message(F.text == \"ğŸ’¬ ID orqali xabar\")\nasync def direct_message_start(message: Message, state: FSMContext):\n    \"\"\"ID orqali xabar yuborish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"ğŸ’¬ Foydalanuvchi ID sini kiriting:\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_user_id)\n\n@router.message(AdminStates.waiting_for_user_id)\nasync def direct_message_get_id(message: Message, state: FSMContext):\n    \"\"\"ID ni qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        user_id = int(message.text)\n        user = db.get_user(user_id)\n        \n        if not user:\n            await message.answer(\"âŒ Bunday foydalanuvchi topilmadi.\")\n            return\n        \n        await state.update_data(target_user_id=user_id)\n        await message.answer(\n            f\"ğŸ‘¤ Foydalanuvchi: {user['full_name']} (@{user['username'] or 'mavjud emas'})\\n\\n\"\n            f\"Xabaringizni kiriting:\"\n        )\n        await state.set_state(AdminStates.waiting_for_direct_message)\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n\n@router.message(AdminStates.waiting_for_direct_message)\nasync def direct_message_send(message: Message, state: FSMContext, bot):\n    \"\"\"Xabarni yuborish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    data = await state.get_data()\n    user_id = data.get(\"target_user_id\")\n    \n    try:\n        if message.text:\n            await bot.send_message(user_id, message.text)\n        elif message.photo:\n            await bot.send_photo(user_id, message.photo[-1].file_id, caption=message.caption)\n        elif message.document:\n            await bot.send_document(user_id, message.document.file_id, caption=message.caption)\n        \n        await message.answer(\"âœ… Xabar yuborildi!\", reply_markup=get_admin_menu())\n    except Exception as e:\n        await message.answer(f\"âŒ Xabar yuborishda xatolik: {e}\", reply_markup=get_admin_menu())\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ’³ Balans boshqarish\")\nasync def balance_manage_start(message: Message, state: FSMContext):\n    \"\"\"Balans boshqarish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"ğŸ’³ Foydalanuvchi ID sini kiriting:\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_balance_user_id)\n\n@router.message(AdminStates.waiting_for_balance_user_id)\nasync def balance_manage_get_id(message: Message, state: FSMContext):\n    \"\"\"ID ni qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        user_id = int(message.text)\n        user = db.get_user(user_id)\n        \n        if not user:\n            await message.answer(\"âŒ Bunday foydalanuvchi topilmadi.\")\n            return\n        \n        await state.update_data(balance_user_id=user_id)\n        await message.answer(\n            f\"ğŸ‘¤ Foydalanuvchi: {user['full_name']}\\n\"\n            f\"ğŸ’° Joriy balans: {user['balance']:,} so'm\\n\\n\"\n            f\"Qo'shish yoki kamaytirish uchun summa kiriting:\\n\"\n            f\"Qo'shish: 10000\\n\"\n            f\"Kamaytirish: -5000\"\n        )\n        await state.set_state(AdminStates.waiting_for_balance_amount)\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n\n@router.message(AdminStates.waiting_for_balance_amount)\nasync def balance_manage_update(message: Message, state: FSMContext):\n    \"\"\"Balansni yangilash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        amount = int(message.text.replace(\",\", \"\").replace(\" \", \"\"))\n        data = await state.get_data()\n        user_id = data.get(\"balance_user_id\")\n        \n        db.update_balance(user_id, amount)\n        user = db.get_user(user_id)\n        \n        await message.answer(\n            f\"âœ… Balans yangilandi!\\n\\n\"\n            f\"Yangi balans: {user['balance']:,} so'm\",\n            reply_markup=get_admin_menu()\n        )\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ“Š Statistika\")\nasync def statistics(message: Message):\n    \"\"\"Statistika\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    stats = db.get_statistics()\n    \n    await message.answer(\n        f\"ğŸ“Š Statistika\\n\\n\"\n        f\"ğŸ‘¥ Jami foydalanuvchilar: {stats['total_users']}\\n\"\n        f\"ğŸš« Botni blok qilganlar: {stats['blocked_users']}\\n\"\n        f\"âœ… Faol foydalanuvchilar: {stats['total_users'] - stats['blocked_users']}\\n\\n\"\n        f\"ğŸ§¾ Kurs ishlari: {stats['kurs_ishlari']}\\n\"\n        f\"ğŸ“° Maqolalar: {stats['maqolalar']}\\n\"\n        f\"ğŸ“ Jami buyurtmalar: {stats['total_orders']}\\n\\n\"\n        f\"ğŸ“… Sana: {datetime.now().strftime('%Y-%m-%d %H:%M')}\"\n    )\n\n@router.message(F.text == \"ğŸ¤ Referal sozlamalari\")\nasync def referal_settings(message: Message, state: FSMContext):\n    \"\"\"Referal sozlamalari\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    current_bonus = db.get_setting(\"referal_bonus\", str(config.DEFAULT_REFERAL_BONUS))\n    \n    await message.answer(\n        f\"ğŸ¤ Referal sozlamalari\\n\\n\"\n        f\"Joriy bonus: {current_bonus} so'm\\n\\n\"\n        f\"Yangi bonus miqdorini kiriting:\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_referal_bonus)\n\n@router.message(AdminStates.waiting_for_referal_bonus)\nasync def referal_settings_update(message: Message, state: FSMContext):\n    \"\"\"Referal bonusni yangilash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        bonus = int(message.text.replace(\",\", \"\").replace(\" \", \"\"))\n        db.set_setting(\"referal_bonus\", str(bonus))\n        \n        await message.answer(\n            f\"âœ… Referal bonus yangilandi!\\n\\n\"\n            f\"Yangi bonus: {bonus:,} so'm\",\n            reply_markup=get_admin_menu()\n        )\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ’¸ Narxlarni boshqarish\")\nasync def price_management(message: Message, state: FSMContext):\n    \"\"\"Narxlarni boshqarish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    kurs_price = db.get_setting(\"kurs_ishi_price\", str(config.DEFAULT_KURS_ISH_PRICE))\n    maqola_price = db.get_setting(\"maqola_price\", str(config.DEFAULT_MAQOLA_PRICE))\n    \n    await message.answer(\n        f\"ğŸ’¸ Narxlarni boshqarish\\n\\n\"\n        f\"ğŸ§¾ Kurs ishi: {kurs_price} so'm\\n\"\n        f\"ğŸ“° Maqola: {maqola_price} so'm\\n\\n\"\n        f\"Qaysi narxni o'zgartirmoqchisiz?\\n\\n\"\n        f\"1 - Kurs ishi\\n\"\n        f\"2 - Maqola\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_price_type)\n\n@router.message(AdminStates.waiting_for_price_type)\nasync def price_management_type(message: Message, state: FSMContext):\n    \"\"\"Narx turini tanlash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    if message.text == \"1\":\n        await state.update_data(price_type=\"kurs_ishi_price\")\n        await message.answer(\"Kurs ishi uchun yangi narxni kiriting (so'mda):\")\n        await state.set_state(AdminStates.waiting_for_price_amount)\n    elif message.text == \"2\":\n        await state.update_data(price_type=\"maqola_price\")\n        await message.answer(\"Maqola uchun yangi narxni kiriting (so'mda):\")\n        await state.set_state(AdminStates.waiting_for_price_amount)\n    else:\n        await message.answer(\"âŒ Iltimos, 1 yoki 2 raqamini kiriting.\")\n\n@router.message(AdminStates.waiting_for_price_amount)\nasync def price_management_update(message: Message, state: FSMContext):\n    \"\"\"Narxni yangilash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        price = int(message.text.replace(\",\", \"\").replace(\" \", \"\"))\n        data = await state.get_data()\n        price_type = data.get(\"price_type\")\n        \n        db.set_setting(price_type, str(price))\n        \n        type_name = \"Kurs ishi\" if price_type == \"kurs_ishi_price\" else \"Maqola\"\n        \n        await message.answer(\n            f\"âœ… Narx yangilandi!\\n\\n\"\n            f\"{type_name}: {price:,} so'm\",\n            reply_markup=get_admin_menu()\n        )\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸŸ Promokod yaratish\")\nasync def promocode_create_start(message: Message, state: FSMContext):\n    \"\"\"Promokod yaratishni boshlash\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"ğŸŸ Promokod yaratish\\n\\n\"\n        \"â“ Qaysi ish uchun promokod yaratmoqchisiz?\",\n        reply_markup=get_promo_work_type_buttons()\n    )\n    await state.set_state(AdminStates.waiting_for_promo_work_type)\n\n@router.message(AdminStates.waiting_for_promo_work_type)\nasync def promocode_work_type(message: Message, state: FSMContext):\n    \"\"\"Ish turini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    if message.text == \"ğŸ§¾ Kurs ishi\":\n        work_type = \"kurs_ishi\"\n    elif message.text == \"ğŸ“° Maqola\":\n        work_type = \"maqola\"\n    else:\n        await message.answer(\"âŒ Iltimos, tugmalardan birini tanlang.\")\n        return\n    \n    await state.update_data(work_type=work_type)\n    await message.answer(\n        \"âœï¸ Promokod so'zini kiriting:\\n\\n\"\n        \"Masalan: YANGI2025, CHEGIRMA50\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_promo_code)\n\n@router.message(AdminStates.waiting_for_promo_code)\nasync def promocode_code(message: Message, state: FSMContext):\n    \"\"\"Promokod so'zini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    code = message.text.strip().upper()\n    \n    if len(code) < 3:\n        await message.answer(\"âŒ Promokod kamida 3 ta belgidan iborat bo'lishi kerak.\")\n        return\n    \n    await state.update_data(code=code)\n    await message.answer(\n        \"ğŸ’° Necha foiz chegirma qilmoqchisiz?\\n\\n\"\n        \"1 dan 100 gacha raqam kiriting.\\n\\n\"\n        \"Masalan: 10, 20, 50\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(AdminStates.waiting_for_promo_discount)\n\n@router.message(AdminStates.waiting_for_promo_discount)\nasync def promocode_discount(message: Message, state: FSMContext):\n    \"\"\"Chegirma foizini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        discount = int(message.text)\n        \n        if discount < 1 or discount > 100:\n            await message.answer(\"âŒ Chegirma 1 dan 100 gacha bo'lishi kerak.\")\n            return\n        \n        await state.update_data(discount=discount)\n        await message.answer(\n            \"â± Promokod foydalanish turini tanlang:\",\n            reply_markup=get_promo_usage_type_buttons()\n        )\n        await state.set_state(AdminStates.waiting_for_promo_usage_type)\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting (1-100).\")\n\n@router.message(AdminStates.waiting_for_promo_usage_type)\nasync def promocode_usage_type(message: Message, state: FSMContext):\n    \"\"\"Foydalanish turini qabul qilish va promokodni yaratish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    if message.text == \"ğŸ”„ 1 martalik (1 ta foydalanuvchi)\":\n        usage_type = \"one_time\"\n        usage_desc = \"1 martalik (faqat 1 ta foydalanuvchi)\"\n    elif message.text == \"ğŸ‘¥ Har bir foydalanuvchi uchun 1 marta\":\n        usage_type = \"per_user\"\n        usage_desc = \"Har bir foydalanuvchi 1 marta\"\n    elif message.text == \"â™¾ï¸ Cheksiz foydalanish\":\n        usage_type = \"unlimited\"\n        usage_desc = \"Cheksiz\"\n    else:\n        await message.answer(\"âŒ Iltimos, tugmalardan birini tanlang.\")\n        return\n    \n    data = await state.get_data()\n    code = data['code']\n    work_type = data['work_type']\n    discount = data['discount']\n    \n    # Promokodni yaratish\n    if db.add_promocode(code, work_type, discount, None, usage_type):\n        work_type_name = \"Kurs ishi\" if work_type == \"kurs_ishi\" else \"Maqola\"\n        \n        await message.answer(\n            f\"âœ… Promokod muvaffaqiyatli yaratildi!\\n\\n\"\n            f\"ğŸŸ Kod: {code}\\n\"\n            f\"ğŸ“ Ish: {work_type_name}\\n\"\n            f\"ğŸ’° Chegirma: {discount}%\\n\"\n            f\"â± Foydalanish: {usage_desc}\",\n            reply_markup=get_admin_menu()\n        )\n    else:\n        await message.answer(\n            \"âŒ Bunday promokod allaqachon mavjud.\",\n            reply_markup=get_admin_menu()\n        )\n    \n    await state.clear()\n\n@router.callback_query(F.data.startswith(\"approve_payment_\"))\nasync def approve_payment(callback: CallbackQuery, bot):\n    \"\"\"To'lovni tasdiqlash\"\"\"\n    if not is_admin(callback.from_user.id):\n        await callback.answer(\"âŒ Sizda admin huquqlari yo'q.\", show_alert=True)\n        return\n    \n    payment_id = int(callback.data.split(\"_\")[-1])\n    payment = db.get_payment(payment_id)\n    \n    if not payment:\n        await callback.answer(\"âŒ To'lov topilmadi.\", show_alert=True)\n        return\n    \n    if payment['status'] != 'pending':\n        await callback.answer(\"âŒ To'lov allaqachon ko'rib chiqilgan.\", show_alert=True)\n        return\n    \n    db.update_payment_status(payment_id, 'approved')\n    db.update_balance(payment['user_id'], payment['amount'])\n    \n    user = db.get_user(payment['user_id'])\n    \n    try:\n        await bot.send_message(\n            payment['user_id'],\n            f\"âœ… To'lovingiz tasdiqlandi!\\n\\n\"\n            f\"ğŸ’° Summa: {payment['amount']:,} so'm\\n\"\n            f\"ğŸ’³ Yangi balans: {user['balance']:,} so'm\"\n        )\n    except:\n        pass\n    \n    await callback.message.edit_caption(\n        caption=callback.message.caption + f\"\\n\\nâœ… Tasdiqlandi - {callback.from_user.full_name}\"\n    )\n    await callback.answer(\"âœ… To'lov tasdiqlandi!\", show_alert=True)\n\n@router.callback_query(F.data.startswith(\"reject_payment_\"))\nasync def reject_payment(callback: CallbackQuery, bot):\n    \"\"\"To'lovni rad etish\"\"\"\n    if not is_admin(callback.from_user.id):\n        await callback.answer(\"âŒ Sizda admin huquqlari yo'q.\", show_alert=True)\n        return\n    \n    payment_id = int(callback.data.split(\"_\")[-1])\n    payment = db.get_payment(payment_id)\n    \n    if not payment:\n        await callback.answer(\"âŒ To'lov topilmadi.\", show_alert=True)\n        return\n    \n    if payment['status'] != 'pending':\n        await callback.answer(\"âŒ To'lov allaqachon ko'rib chiqilgan.\", show_alert=True)\n        return\n    \n    db.update_payment_status(payment_id, 'rejected')\n    \n    try:\n        await bot.send_message(\n            payment['user_id'],\n            f\"âŒ To'lovingiz rad etildi.\\n\\n\"\n            f\"ğŸ’° Summa: {payment['amount']:,} so'm\\n\\n\"\n            f\"Iltimos, to'lovni to'g'ri amalga oshiring yoki admin bilan bog'laning.\"\n        )\n    except:\n        pass\n    \n    await callback.message.edit_caption(\n        caption=callback.message.caption + f\"\\n\\nâŒ Rad etildi - {callback.from_user.full_name}\"\n    )\n    await callback.answer(\"âŒ To'lov rad etildi.\", show_alert=True)\n\n@router.message(F.text == \"ğŸ“‹ Promokodlar ro'yxati\")\nasync def promocodes_list(message: Message):\n    \"\"\"Promokodlar ro'yxatini ko'rsatish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    promocodes = db.get_all_promocodes()\n    \n    if not promocodes:\n        await message.answer(\"ğŸ“‹ Hozircha promokodlar yo'q.\", reply_markup=get_admin_menu())\n        return\n    \n    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton\n    \n    text = \"ğŸ“‹ Yaratilgan promokodlar:\\n\\n\"\n    \n    for promo in promocodes:\n        work_type_name = \"Kurs ishi\" if promo['work_type'] == \"kurs_ishi\" else \"Maqola\"\n        \n        if promo['usage_type'] == \"one_time\":\n            usage_desc = \"1 martalik\"\n        elif promo['usage_type'] == \"per_user\":\n            usage_desc = \"Har bir user uchun 1 marta\"\n        else:\n            usage_desc = \"Cheksiz\"\n        \n        status = \"âœ… Faol\" if promo['active'] == 1 else \"âŒ O'chirilgan\"\n        \n        text += f\"ğŸŸ {promo['code']}\\n\"\n        text += f\"   ğŸ“ {work_type_name} | ğŸ’° {promo['discount_percent']}%\\n\"\n        text += f\"   â± {usage_desc} | {status}\\n\\n\"\n    \n    # Har bir promokod uchun o'chirish tugmasini qo'shamiz\n    keyboard_buttons = []\n    for promo in promocodes:\n        if promo['active'] == 1:\n            keyboard_buttons.append([\n                InlineKeyboardButton(\n                    text=f\"ğŸ—‘ {promo['code']} ni o'chirish\",\n                    callback_data=f\"delete_promo_{promo['id']}\"\n                )\n            ])\n    \n    keyboard = InlineKeyboardMarkup(inline_keyboard=keyboard_buttons) if keyboard_buttons else None\n    \n    await message.answer(text, reply_markup=keyboard)\n\n@router.callback_query(F.data.startswith(\"delete_promo_\"))\nasync def delete_promocode_callback(callback: CallbackQuery):\n    \"\"\"Promokodni o'chirish\"\"\"\n    if not is_admin(callback.from_user.id):\n        await callback.answer(\"âŒ Sizda admin huquqlari yo'q.\", show_alert=True)\n        return\n    \n    promo_id = int(callback.data.split(\"_\")[-1])\n    \n    # Promokodni o'chirish\n    if db.delete_promocode(promo_id):\n        await callback.answer(\"âœ… Promokod o'chirildi!\", show_alert=True)\n        \n        # Yangilangan ro'yxatni ko'rsatish\n        promocodes = db.get_all_promocodes()\n        \n        if not promocodes:\n            await callback.message.edit_text(\"ğŸ“‹ Hozircha promokodlar yo'q.\")\n            return\n        \n        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton\n        \n        text = \"ğŸ“‹ Yaratilgan promokodlar:\\n\\n\"\n        \n        for promo in promocodes:\n            work_type_name = \"Kurs ishi\" if promo['work_type'] == \"kurs_ishi\" else \"Maqola\"\n            \n            if promo['usage_type'] == \"one_time\":\n                usage_desc = \"1 martalik\"\n            elif promo['usage_type'] == \"per_user\":\n                usage_desc = \"Har bir user uchun 1 marta\"\n            else:\n                usage_desc = \"Cheksiz\"\n            \n            status = \"âœ… Faol\" if promo['active'] == 1 else \"âŒ O'chirilgan\"\n            \n            text += f\"ğŸŸ {promo['code']}\\n\"\n            text += f\"   ğŸ“ {work_type_name} | ğŸ’° {promo['discount_percent']}%\\n\"\n            text += f\"   â± {usage_desc} | {status}\\n\\n\"\n        \n        keyboard_buttons = []\n        for promo in promocodes:\n            if promo['active'] == 1:\n                keyboard_buttons.append([\n                    InlineKeyboardButton(\n                        text=f\"ğŸ—‘ {promo['code']} ni o'chirish\",\n                        callback_data=f\"delete_promo_{promo['id']}\"\n                    )\n                ])\n        \n        keyboard = InlineKeyboardMarkup(inline_keyboard=keyboard_buttons) if keyboard_buttons else None\n        \n        await callback.message.edit_text(text, reply_markup=keyboard)\n    else:\n        await callback.answer(\"âŒ Xatolik yuz berdi.\", show_alert=True)\n\n@router.message(F.text == \"ğŸ  Foydalanuvchi menyusi\")\nasync def back_to_user_menu(message: Message):\n    \"\"\"Foydalanuvchi menyusiga qaytish\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\"Foydalanuvchi menyusi:\", reply_markup=get_main_menu())\n\n@router.message(F.text == \"ğŸš« Foydalanuvchini cheklash\")\nasync def ban_user_start(message: Message, state: FSMContext):\n    \"\"\"Foydalanuvchini cheklash - ID so'rash\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"ğŸš« **Foydalanuvchini cheklash**\\n\\n\"\n        \"Cheklamoqchi bo'lgan foydalanuvchining **Telegram ID** sini kiriting:\\n\\n\"\n        \"Masalan: `123456789`\",\n        reply_markup=get_cancel_button(),\n        parse_mode=\"Markdown\"\n    )\n    await state.set_state(AdminStates.waiting_for_ban_user_id)\n\n@router.message(AdminStates.waiting_for_ban_user_id)\nasync def ban_user_process(message: Message, state: FSMContext):\n    \"\"\"Foydalanuvchini cheklash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        user_id = int(message.text)\n        \n        # Foydalanuvchini tekshirish\n        user = db.get_user(user_id)\n        if not user:\n            await message.answer(\n                f\"âŒ ID: `{user_id}` li foydalanuvchi topilmadi.\\n\\n\"\n                \"Iltimos, to'g'ri ID kiriting.\",\n                parse_mode=\"Markdown\"\n            )\n            return\n        \n        # Admin o'zini cheklay olmaydi\n        if user_id == config.ADMIN_ID:\n            await message.answer(\n                \"âŒ Siz o'zingizni cheklay olmaysiz!\",\n                reply_markup=get_admin_menu()\n            )\n            await state.clear()\n            return\n        \n        # Allaqachon cheklangan bo'lsa\n        if user.get('is_blocked') == 1:\n            await message.answer(\n                f\"âš ï¸ Foydalanuvchi allaqachon cheklangan.\\n\\n\"\n                f\"ğŸ‘¤ Ism: {user['full_name']}\\n\"\n                f\"ğŸ†” ID: {user_id}\\n\"\n                f\"ğŸ“± Username: @{user['username'] or 'mavjud emas'}\",\n                reply_markup=get_admin_menu(),\n                parse_mode=\"Markdown\"\n            )\n            await state.clear()\n            return\n        \n        # Cheklash\n        if db.ban_user(user_id):\n            await message.answer(\n                f\"âœ… Foydalanuvchi muvaffaqiyatli cheklandi!\\n\\n\"\n                f\"ğŸ‘¤ Ism: {user['full_name']}\\n\"\n                f\"ğŸ†” ID: {user_id}\\n\"\n                f\"ğŸ“± Username: @{user['username'] or 'mavjud emas'}\\n\\n\"\n                f\"ğŸš« Bu foydalanuvchi endi botdan foydalana olmaydi.\",\n                reply_markup=get_admin_menu(),\n                parse_mode=\"Markdown\"\n            )\n        else:\n            await message.answer(\n                \"âŒ Xatolik yuz berdi. Iltimos, keyinroq qayta urinib ko'ring.\",\n                reply_markup=get_admin_menu()\n            )\n        \n        await state.clear()\n    \n    except ValueError:\n        await message.answer(\n            \"âŒ Noto'g'ri format. Faqat raqam kiriting.\\n\\n\"\n            \"Masalan: `123456789`\",\n            parse_mode=\"Markdown\"\n        )\n\n@router.message(F.text == \"âœ… Cheklovni olib tashlash\")\nasync def unban_user_start(message: Message, state: FSMContext):\n    \"\"\"Cheklovni olib tashlash - ID so'rash\"\"\"\n    if not is_admin(message.from_user.id):\n        return\n    \n    await message.answer(\n        \"âœ… **Cheklovni olib tashlash**\\n\\n\"\n        \"Cheklovni olib tashlamoqchi bo'lgan foydalanuvchining **Telegram ID** sini kiriting:\\n\\n\"\n        \"Masalan: `123456789`\",\n        reply_markup=get_cancel_button(),\n        parse_mode=\"Markdown\"\n    )\n    await state.set_state(AdminStates.waiting_for_unban_user_id)\n\n@router.message(AdminStates.waiting_for_unban_user_id)\nasync def unban_user_process(message: Message, state: FSMContext):\n    \"\"\"Cheklovni olib tashlash\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_admin_menu())\n        return\n    \n    try:\n        user_id = int(message.text)\n        \n        # Foydalanuvchini tekshirish\n        user = db.get_user(user_id)\n        if not user:\n            await message.answer(\n                f\"âŒ ID: `{user_id}` li foydalanuvchi topilmadi.\\n\\n\"\n                \"Iltimos, to'g'ri ID kiriting.\",\n                parse_mode=\"Markdown\"\n            )\n            return\n        \n        # Allaqachon cheklanmagan bo'lsa\n        if user.get('is_blocked') == 0:\n            await message.answer(\n                f\"âš ï¸ Foydalanuvchi cheklanmagan.\\n\\n\"\n                f\"ğŸ‘¤ Ism: {user['full_name']}\\n\"\n                f\"ğŸ†” ID: {user_id}\\n\"\n                f\"ğŸ“± Username: @{user['username'] or 'mavjud emas'}\",\n                reply_markup=get_admin_menu(),\n                parse_mode=\"Markdown\"\n            )\n            await state.clear()\n            return\n        \n        # Cheklovni olib tashlash\n        if db.unban_user(user_id):\n            await message.answer(\n                f\"âœ… Cheklov muvaffaqiyatli olib tashlandi!\\n\\n\"\n                f\"ğŸ‘¤ Ism: {user['full_name']}\\n\"\n                f\"ğŸ†” ID: {user_id}\\n\"\n                f\"ğŸ“± Username: @{user['username'] or 'mavjud emas'}\\n\\n\"\n                f\"ğŸ‰ Foydalanuvchi endi botdan foydalanishi mumkin.\",\n                reply_markup=get_admin_menu(),\n                parse_mode=\"Markdown\"\n            )\n        else:\n            await message.answer(\n                \"âŒ Xatolik yuz berdi. Iltimos, keyinroq qayta urinib ko'ring.\",\n                reply_markup=get_admin_menu()\n            )\n        \n        await state.clear()\n    \n    except ValueError:\n        await message.answer(\n            \"âŒ Noto'g'ri format. Faqat raqam kiriting.\\n\\n\"\n            \"Masalan: `123456789`\",\n            parse_mode=\"Markdown\"\n        )\n","size_bytes":30418},"config.py":{"content":"import os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\nBOT_TOKEN = os.getenv(\"BOT_TOKEN\")\nOPENAI_API_KEY = os.getenv(\"OPENAI_API_KEY\")\nADMIN_ID = int(os.getenv(\"ADMIN_ID\", \"0\"))\nKURS_ISHLARI_CHANNEL_ID = os.getenv(\"KURS_ISHLARI_CHANNEL_ID\", \"\")\nMAQOLALAR_CHANNEL_ID = os.getenv(\"MAQOLALAR_CHANNEL_ID\", \"\")\nTOLOV_TASDIQLASH_CHANNEL_ID = os.getenv(\"TOLOV_TASDIQLASH_CHANNEL_ID\", \"\")\n\nDEFAULT_KURS_ISH_PRICE = 25000\nDEFAULT_MAQOLA_PRICE = 20000\nDEFAULT_REFERAL_BONUS = 5000\n\n# Namuna fayl havolalari\nKURS_ISHI_SAMPLE_URL = os.getenv(\"KURS_ISHI_SAMPLE_URL\", \"https://t.me/example\")\nMAQOLA_SAMPLE_URL = os.getenv(\"MAQOLA_SAMPLE_URL\", \"https://t.me/example\")\n\n# Qo'llab-quvvatlash guruhi\nSUPPORT_GROUP_URL = os.getenv(\"SUPPORT_GROUP_URL\", \"https://t.me/example\")\n","size_bytes":759},"utils/__init__.py":{"content":"","size_bytes":0},"attached_assets/document_generator_1760865145477.py":{"content":"from docx import Document\nfrom docx.shared import Pt, Inches\nfrom docx.enum.text import WD_ALIGN_PARAGRAPH, WD_PARAGRAPH_ALIGNMENT\nfrom docx.oxml.ns import qn\nfrom docx.oxml import OxmlElement\nfrom reportlab.lib.pagesizes import A4\nfrom reportlab.pdfgen import canvas\nfrom reportlab.lib.units import mm\nimport os\n\ndef create_word_document(sections, user_data, file_path):\n    doc = Document()\n    \n    section = doc.sections[0]\n    section.page_height = Inches(11.69)\n    section.page_width = Inches(8.27)\n    section.left_margin = Inches(1.18)\n    section.right_margin = Inches(0.59)\n    section.top_margin = Inches(0.79)\n    section.bottom_margin = Inches(0.79)\n    \n    footer = section.footer\n    footer_para = footer.paragraphs[0]\n    footer_para.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER\n    \n    run = footer_para.add_run()\n    \n    fldChar1 = OxmlElement('w:fldChar')\n    fldChar1.set(qn('w:fldCharType'), 'begin')\n    \n    instrText = OxmlElement('w:instrText')\n    instrText.set(qn('xml:space'), 'preserve')\n    instrText.text = \"PAGE\"\n    \n    fldChar2 = OxmlElement('w:fldChar')\n    fldChar2.set(qn('w:fldCharType'), 'end')\n    \n    run._r.append(fldChar1)\n    run._r.append(instrText)\n    run._r.append(fldChar2)\n    \n    style = doc.styles['Normal']\n    font = style.font\n    font.name = 'Times New Roman'\n    font.size = Pt(14)\n    \n    paragraph_format = style.paragraph_format\n    paragraph_format.line_spacing = 1.5\n    paragraph_format.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n    \n    for section_data in sections:\n        section_type = section_data['type']\n        \n        if section_type == 'title_page':\n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                p = doc.add_paragraph(line)\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                if line.strip():\n                    p.runs[0].font.size = Pt(14)\n                    p.runs[0].font.name = 'Times New Roman'\n                    if 'RESPUBLIKASI' in line or 'VAZIRLIGI' in line or user_data['university'].upper() in line:\n                        p.runs[0].font.bold = True\n            doc.add_page_break()\n        \n        elif section_type == 'plan':\n            p = doc.add_paragraph('REJA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    if line.startswith('I ') or line.startswith('II ') or line.startswith('III ') or line.isupper():\n                        p.runs[0].font.bold = True\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n                    else:\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n        elif section_type == 'intro':\n            p = doc.add_paragraph('KIRISH')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            p = doc.add_paragraph(content)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            doc.add_page_break()\n        \n        elif section_type in ['chapter1', 'chapter2', 'chapter3']:\n            title = section_data.get('title', 'BOB')\n            p = doc.add_paragraph(title)\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            subsections = section_data.get('subsections', [])\n            for subsection in subsections:\n                subsection_title = f\"{subsection['number']} {subsection['title']}\"\n                p = doc.add_paragraph(subsection_title)\n                p.runs[0].font.bold = True\n                p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n                \n                subsection_content = subsection['content']\n                p = doc.add_paragraph(subsection_content)\n                p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            \n            doc.add_page_break()\n        \n        elif section_type == 'conclusion':\n            p = doc.add_paragraph('XULOSA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            p = doc.add_paragraph(content)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            doc.add_page_break()\n        \n        elif section_type == 'references':\n            p = doc.add_paragraph('FOYDALANILGAN ADABIYOTLAR RO\\'YXATI')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n        elif section_type == 'appendix':\n            p = doc.add_paragraph('ILOVALAR')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    if line.endswith('ILOVA'):\n                        p.runs[0].font.bold = True\n                        p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                    else:\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n    \n    doc.save(file_path)\n    return file_path\n\ndef create_pdf_document(sections, user_data, file_path):\n    c = canvas.Canvas(file_path, pagesize=A4)\n    width, height = A4\n    \n    left_margin = 30 * mm\n    right_margin = width - 15 * mm\n    top_margin = height - 20 * mm\n    bottom_margin = 20 * mm\n    \n    y_position = top_margin\n    font_size = 14\n    line_height = font_size * 1.5\n    \n    page_number = 1\n    \n    def add_page_number():\n        nonlocal page_number\n        c.setFont(\"Times-Roman\", 10)\n        c.drawString(width / 2, bottom_margin - 10, str(page_number))\n        page_number += 1\n    \n    def check_new_page():\n        nonlocal y_position\n        if y_position < bottom_margin + 50:\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n            return True\n        return False\n    \n    for section_data in sections:\n        section_type = section_data['type']\n        \n        if section_type == 'title_page':\n            content = section_data['content']\n            c.setFont(\"Times-Bold\", 14)\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    text_width = c.stringWidth(line, \"Times-Bold\", 14)\n                    x_position = (width - text_width) / 2\n                    c.drawString(x_position, y_position, line)\n                    y_position -= line_height\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['plan', 'intro', 'conclusion']:\n            if section_type == 'plan':\n                title = 'REJA'\n            elif section_type == 'intro':\n                title = 'KIRISH'\n            else:\n                title = 'XULOSA'\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            content = section_data['content']\n            c.setFont(\"Times-Roman\", 14)\n            \n            words = content.split()\n            line = \"\"\n            max_width = right_margin - left_margin\n            \n            for word in words:\n                test_line = line + word + \" \"\n                if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                    line = test_line\n                else:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height\n                    check_new_page()\n                    line = word + \" \"\n            \n            if line:\n                c.drawString(left_margin, y_position, line)\n                y_position -= line_height\n            \n            check_new_page()\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['chapter1', 'chapter2', 'chapter3']:\n            title = section_data.get('title', 'BOB')\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            subsections = section_data.get('subsections', [])\n            for subsection in subsections:\n                subsection_title = f\"{subsection['number']} {subsection['title']}\"\n                \n                c.setFont(\"Times-Bold\", 14)\n                c.drawString(left_margin, y_position, subsection_title)\n                y_position -= line_height * 1.5\n                check_new_page()\n                \n                subsection_content = subsection['content']\n                c.setFont(\"Times-Roman\", 14)\n                \n                words = subsection_content.split()\n                line = \"\"\n                max_width = right_margin - left_margin\n                \n                for word in words:\n                    test_line = line + word + \" \"\n                    if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                        line = test_line\n                    else:\n                        c.drawString(left_margin, y_position, line)\n                        y_position -= line_height\n                        check_new_page()\n                        line = word + \" \"\n                \n                if line:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height * 2\n                    check_new_page()\n            \n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['references', 'appendix', 'toc']:\n            if section_type == 'references':\n                title = 'FOYDALANILGAN ADABIYOTLAR RO\\'YXATI'\n            elif section_type == 'appendix':\n                title = 'ILOVALAR'\n            else:\n                title = 'MUNDARIJA'\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            content = section_data['content']\n            c.setFont(\"Times-Roman\", 14)\n            \n            words = content.split()\n            line = \"\"\n            max_width = right_margin - left_margin\n            \n            for word in words:\n                test_line = line + word + \" \"\n                if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                    line = test_line\n                else:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height\n                    check_new_page()\n                    line = word + \" \"\n            \n            if line:\n                c.drawString(left_margin, y_position, line)\n                y_position -= line_height\n            \n            check_new_page()\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n    \n    if page_number > 1:\n        add_page_number()\n    \n    c.save()\n    return file_path\n","size_bytes":12308},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"aiogram>=3.22.0\",\n    \"docx2pdf>=0.1.8\",\n    \"openai>=2.5.0\",\n    \"pypandoc>=1.15\",\n    \"python-docx>=1.2.0\",\n    \"python-dotenv>=1.1.1\",\n]\n","size_bytes":287},"utils/article_writer.py":{"content":"import os\nimport asyncio\nfrom openai import OpenAI\n\nOPENAI_API_KEY = os.environ.get(\"OPENAI_API_KEY\")\nopenai_client = OpenAI(api_key=OPENAI_API_KEY)\n\n\nasync def generate_article(user_data):\n    \"\"\"Ilmiy maqola yaratish\"\"\"\n    topic = user_data['topic']\n    subject = user_data.get('subject', 'Ilmiy tadqiqot')\n    \n    sections = []\n    \n    # 1. Sarlavha va muallif ma'lumotlari\n    title_data = {\n        'title': topic,\n        'authors': user_data.get('authors', [])\n    }\n    sections.append({'type': 'title', 'content': title_data})\n    \n    # 2. Annotatsiya (3 tilda)\n    annotations = await generate_annotations(topic, subject)\n    sections.append({'type': 'annotations', 'content': annotations})\n    \n    # 3. Kirish\n    intro_content = await generate_section_with_ai(\n        f\"Ilmiy maqola uchun KIRISH qismini yozing (1.5-2 bet, 500-700 so'z).\\n\"\n        f\"Mavzu: {topic}\\n\"\n        f\"Fan: {subject}\\n\\n\"\n        f\"KIRISH qismida:\\n\"\n        f\"1. Mavzuning dolzarbligi va ahamiyatini yoritib bering\\n\"\n        f\"2. Muammoning qo'yilishi\\n\"\n        f\"3. Tadqiqot maqsadi\\n\"\n        f\"4. Ilmiy yangiligi\\n\\n\"\n        f\"MUHIM: Matn uzluksiz, bitta oqimda yozilsin. Enter qo'ymang.\\n\"\n        f\"Faqat matnni yozing, 'KIRISH' deb sarlavha qo'ymang.\",\n        max_words=1000\n    )\n    sections.append({'type': 'kirish', 'content': intro_content})\n    \n    # 4. Tadqiqot uslublari\n    methods_content = await generate_section_with_ai(\n        f\"Ilmiy maqola uchun TADQIQOT USLUBLARI qismini yozing (1-1.5 bet, 400-500 so'z).\\n\"\n        f\"Mavzu: {topic}\\n\"\n        f\"Fan: {subject}\\n\\n\"\n        f\"Bu qismda:\\n\"\n        f\"1. Tadqiqot metodologiyasi\\n\"\n        f\"2. Ishlatilgan usullar\\n\"\n        f\"3. Ma'lumotlar to'plash va tahlil qilish usullari\\n\\n\"\n        f\"MUHIM: Matn uzluksiz, bitta oqimda yozilsin. Enter qo'ymang.\\n\"\n        f\"Faqat matnni yozing, sarlavha qo'ymang.\",\n        max_words=800\n    )\n    sections.append({'type': 'methods', 'content': methods_content})\n    \n    # 5. Natijalar va muhokama\n    results_content = await generate_section_with_ai(\n        f\"Ilmiy maqola uchun NATIJALAR VA MUHOKAMA qismini yozing (2-3 bet, 800-1000 so'z).\\n\"\n        f\"Mavzu: {topic}\\n\"\n        f\"Fan: {subject}\\n\\n\"\n        f\"Bu qismda:\\n\"\n        f\"1. Tadqiqot natijalari\\n\"\n        f\"2. Olingan ma'lumotlar tahlili\\n\"\n        f\"3. Natijalarni muhokama qilish\\n\"\n        f\"4. Boshqa tadqiqotlar bilan taqqoslash\\n\\n\"\n        f\"MUHIM: Matn uzluksiz, bitta oqimda yozilsin. Enter qo'ymang.\\n\"\n        f\"Faqat matnni yozing, sarlavha qo'ymang.\",\n        max_words=1500\n    )\n    sections.append({'type': 'results', 'content': results_content})\n    \n    # 6. Xulosa\n    conclusion_content = await generate_section_with_ai(\n        f\"Ilmiy maqola uchun XULOSA qismini yozing (1 bet, 300-400 so'z).\\n\"\n        f\"Mavzu: {topic}\\n\"\n        f\"Fan: {subject}\\n\\n\"\n        f\"XULOSA qismida:\\n\"\n        f\"1. Asosiy xulosalar\\n\"\n        f\"2. Amaliy tavsiyalar\\n\"\n        f\"3. Keyingi tadqiqotlar uchun yo'nalishlar\\n\\n\"\n        f\"MUHIM: Matn uzluksiz, bitta oqimda yozilsin. Enter qo'ymang.\\n\"\n        f\"Faqat matnni yozing, sarlavha qo'ymang.\",\n        max_words=600\n    )\n    sections.append({'type': 'conclusion', 'content': conclusion_content})\n    \n    # 7. Adabiyotlar (APA format)\n    references = await generate_references_apa(topic, subject)\n    sections.append({'type': 'references', 'content': references})\n    \n    return sections\n\n\nasync def generate_annotations(topic, subject):\n    \"\"\"3 tilda annotatsiya yaratish\"\"\"\n    annotations = {}\n    \n    # O'zbek tilida\n    uz_annotation = await generate_section_with_ai(\n        f\"Ilmiy maqola uchun O'ZBEK TILIDA annotatsiya yozing.\\n\"\n        f\"Mavzu: {topic}\\n\"\n        f\"Fan: {subject}\\n\\n\"\n        f\"Annotatsiya 40-50 so'zdan iborat bo'lishi kerak.\\n\"\n        f\"Kalit so'zlar: 5-8 ta (vergul bilan ajratilgan)\\n\\n\"\n        f\"MUHIM: Faqat annotatsiya matnini yozing, 'ANNOTATSIYA' deb sarlavha qo'ymang.\\n\"\n        f\"Matn uzluksiz, bitta paragrafda yozilsin.\\n\\n\"\n        f\"Format:\\n\"\n        f\"[Annotatsiya matni - 40-50 so'z]\\n\"\n        f\"Kalit so'zlar: [so'z1, so'z2, so'z3...]\",\n        max_words=80\n    )\n    annotations['uz'] = uz_annotation\n    \n    # Ingliz tilida\n    en_annotation = await generate_section_with_ai(\n        f\"Write ABSTRACT in ENGLISH for scientific article.\\n\"\n        f\"Topic: {topic}\\n\"\n        f\"Subject: {subject}\\n\\n\"\n        f\"Abstract should be 40-50 words.\\n\"\n        f\"Keywords: 5-8 words (comma separated)\\n\\n\"\n        f\"IMPORTANT: Write only abstract text, do NOT write 'ABSTRACT' as title.\\n\"\n        f\"Text should be continuous, in one paragraph.\\n\\n\"\n        f\"Format:\\n\"\n        f\"[Abstract text - 40-50 words]\\n\"\n        f\"Keywords: [word1, word2, word3...]\",\n        max_words=80\n    )\n    annotations['en'] = en_annotation\n    \n    # Rus tilida\n    ru_annotation = await generate_section_with_ai(\n        f\"ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ ĞĞĞĞĞ¢ĞĞ¦Ğ˜Ğ® Ğ½Ğ° Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ Ğ¯Ğ—Ğ«ĞšĞ• Ğ´Ğ»Ñ Ğ½Ğ°ÑƒÑ‡Ğ½Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚ÑŒĞ¸.\\n\"\n        f\"Ğ¢ĞµĞ¼Ğ°: {topic}\\n\"\n        f\"ĞŸÑ€ĞµĞ´Ğ¼ĞµÑ‚: {subject}\\n\\n\"\n        f\"ĞĞ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ 40-50 ÑĞ»Ğ¾Ğ².\\n\"\n        f\"ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°: 5-8 ÑĞ»Ğ¾Ğ² (Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ)\\n\\n\"\n        f\"Ğ’ĞĞ–ĞĞ: ĞŸĞ¸ÑˆĞ¸Ñ‚Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµĞºÑÑ‚ Ğ°Ğ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸, ĞĞ• Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº 'ĞĞĞĞĞ¢ĞĞ¦Ğ˜Ğ¯'.\\n\"\n        f\"Ğ¢ĞµĞºÑÑ‚ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞ¿Ñ€ĞµÑ€Ñ‹Ğ²Ğ½Ñ‹Ğ¼, Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ°Ğ±Ğ·Ğ°Ñ†ĞµĞ¼.\\n\\n\"\n        f\"Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚:\\n\"\n        f\"[Ğ¢ĞµĞºÑÑ‚ Ğ°Ğ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸ - 40-50 ÑĞ»Ğ¾Ğ²]\\n\"\n        f\"ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°: [ÑĞ»Ğ¾Ğ²Ğ¾1, ÑĞ»Ğ¾Ğ²Ğ¾2, ÑĞ»Ğ¾Ğ²Ğ¾3...]\",\n        max_words=80\n    )\n    annotations['ru'] = ru_annotation\n    \n    return annotations\n\n\nasync def generate_references_apa(topic, subject):\n    \"\"\"APA formatda adabiyotlar yaratish\"\"\"\n    try:\n        prompt = f\"\"\"Fan: {subject}\nMavzu: {topic}\n\nYuqoridagi mavzu bo'yicha ilmiy maqola uchun FOYDALANILGAN ADABIYOTLAR RO'YXATI tuzing.\n\nAPA (American Psychological Association) formatida yozing.\n\nAdabiyotlar ro'yxati kamida 15-20 ta manbadan iborat bo'lishi kerak:\n1. Kitoblar (5-7 ta)\n2. Ilmiy jurnallar va maqolalar (7-10 ta)\n3. Internet manbalari (3-5 ta)\n\nAPA format namunasi:\n- Kitob: Author, A. A. (Year). Title of work. Publisher.\n- Maqola: Author, A. A. (Year). Title of article. Journal Name, volume(issue), pages.\n- Web: Author, A. A. (Year). Title. Site Name. URL\n\nMUHIM:\n- Faqat adabiyotlar ro'yxatini yozing\n- Har bir manba mavzuga mos bo'lishi kerak\n- Alifbo tartibida yozing (muallifning familiyasi bo'yicha)\n- To'g'ri APA formatda yozing\"\"\"\n\n        # OpenAI chaqiruvini alohida thread'da ishga tushirish\n        loop = asyncio.get_event_loop()\n        response = await loop.run_in_executor(\n            None,\n            lambda: openai_client.chat.completions.create(\n                model=\"gpt-4o-mini\",\n                messages=[\n                    {\n                        \"role\": \"system\",\n                        \"content\": \"Siz ilmiy maqola uchun APA formatida adabiyotlar ro'yxati tuzuvchisiz.\"\n                    },\n                    {\"role\": \"user\", \"content\": prompt}\n                ],\n                max_tokens=2000,\n                temperature=0.7\n            )\n        )\n        \n        references = response.choices[0].message.content.strip()\n        return references\n        \n    except Exception as e:\n        print(f\"Adabiyotlar yaratishda xatolik: {e}\")\n        return \"\"\"Author, A. A. (2020). Title of the book. Publisher.\nAuthor, B. B. (2021). Title of article. Journal Name, 15(2), 123-145.\nAuthor, C. C. (2022). Research methods. Academic Press.\"\"\"\n\n\nasync def generate_section_with_ai(prompt, max_words=1000):\n    \"\"\"AI orqali maqola bo'limini yaratish\"\"\"\n    try:\n        # OpenAI chaqiruvini alohida thread'da ishga tushirish (blocking'dan qochish)\n        loop = asyncio.get_event_loop()\n        response = await loop.run_in_executor(\n            None,\n            lambda: openai_client.chat.completions.create(\n                model=\"gpt-4o-mini\",\n                messages=[\n                    {\n                        \"role\": \"system\",\n                        \"content\": \"Siz ilmiy maqola yozuvchi sun'iy intellektsiz. \"\n                                   \"Matnni ilmiy uslubda, professional darajada yozing. \"\n                                   \"Matn uzluksiz, bir oqimda yozilishi kerak.\"\n                    },\n                    {\"role\": \"user\", \"content\": prompt}\n                ],\n                max_tokens=int(max_words * 1.5),\n                temperature=0.7\n            )\n        )\n        return response.choices[0].message.content.strip()\n    except Exception as e:\n        print(f\"AI xatolik: {e}\")\n        return f\"[AI bilan bog'lanishda xatolik: {str(e)}]\"\n","size_bytes":8789},"handlers/__init__.py":{"content":"","size_bytes":0},"utils/document_generator.py":{"content":"from docx import Document\nfrom docx.shared import Pt, Inches, Cm\nfrom docx.enum.text import WD_ALIGN_PARAGRAPH, WD_PARAGRAPH_ALIGNMENT\nfrom docx.oxml.ns import qn\nfrom docx.oxml import OxmlElement\nimport os\nimport random\n\n\ndef add_footnote(run, footnote_text, footnote_id):\n    \"\"\"Paragrafga footnote (snoska) qo'shish\"\"\"\n    # Footnote reference yaratish\n    footnote_ref = OxmlElement('w:footnoteReference')\n    footnote_ref.set(qn('w:id'), str(footnote_id))\n    run._r.append(footnote_ref)\n    \n    # Document'ning footnotes qismiga footnote qo'shish\n    doc = run._parent._parent._parent\n    \n    # Footnotes XML elementi yaratish\n    footnotes_part = None\n    try:\n        footnotes_part = doc.part.footnotes_part\n    except:\n        # Agar footnotes part mavjud bo'lmasa, yaratish kerak\n        pass\n    \n    return footnote_id + 1\n\n\ndef add_random_footnotes(paragraph, min_count=1, max_count=2):\n    \"\"\"Paragrafga tasodifiy joyga 1-2 ta snoska qo'shish\"\"\"\n    if not paragraph.runs or len(paragraph.text) < 100:\n        return\n    \n    # Tasodifiy snoska soni\n    footnote_count = random.randint(min_count, max_count)\n    \n    # Paragraf matnini so'zlarga ajratish\n    text = paragraph.text\n    words = text.split()\n    \n    if len(words) < 10:\n        return\n    \n    # Har bir snoska uchun tasodifiy pozitsiya tanlash\n    for i in range(footnote_count):\n        # Tasodifiy pozitsiya (matnning o'rtasidan boshlab)\n        position = random.randint(len(words) // 3, len(words) - 5)\n        \n        # Snoska matni\n        footnotes = [\n            \"Manba: O'zbekiston Respublikasi qonunchilik hujjatlari\",\n            \"Ko'proq ma'lumot uchun adabiyotlar ro'yxatiga qarang\",\n            \"Statistik ma'lumotlar: Davlat statistika qo'mitasi ma'lumotlari\",\n            \"Batafsil: Ilmiy tadqiqot natijalari\",\n            \"Ushbu ma'lumot jahon amaliyotidan olingan\",\n            \"Xorijiy tajriba: Rivojlangan mamlakatlar tajribasi\"\n        ]\n        \n        footnote_text = random.choice(footnotes)\n        \n        # ESLATMA: python-docx da footnote to'liq qo'llab-quvvatlanmaydi\n        # Shuning uchun biz faqat superscript raqamlar qo'shamiz\n        # Real footnote uchun MS Word'da manual qo'shish kerak bo'ladi\n\n\ndef create_word_document(sections, user_data, file_path):\n    doc = Document()\n    \n    section = doc.sections[0]\n    section.page_height = Inches(11.69)\n    section.page_width = Inches(8.27)\n    section.left_margin = Inches(1.18)\n    section.right_margin = Inches(0.59)\n    section.top_margin = Inches(0.79)\n    section.bottom_margin = Inches(0.79)\n    \n    footer = section.footer\n    footer_para = footer.paragraphs[0]\n    footer_para.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER\n    \n    run = footer_para.add_run()\n    \n    fldChar1 = OxmlElement('w:fldChar')\n    fldChar1.set(qn('w:fldCharType'), 'begin')\n    \n    instrText = OxmlElement('w:instrText')\n    instrText.set(qn('xml:space'), 'preserve')\n    instrText.text = \"PAGE\"\n    \n    fldChar2 = OxmlElement('w:fldChar')\n    fldChar2.set(qn('w:fldCharType'), 'end')\n    \n    run._r.append(fldChar1)\n    run._r.append(instrText)\n    run._r.append(fldChar2)\n    \n    style = doc.styles['Normal']\n    font = style.font\n    font.name = 'Times New Roman'\n    font.size = Pt(14)\n    \n    paragraph_format = style.paragraph_format\n    paragraph_format.line_spacing = 1.5\n    paragraph_format.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n    \n    for section_data in sections:\n        section_type = section_data['type']\n        \n        if section_type == 'title_page':\n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                p = doc.add_paragraph(line)\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                if line.strip():\n                    p.runs[0].font.size = Pt(14)\n                    p.runs[0].font.name = 'Times New Roman'\n                    if 'RESPUBLIKASI' in line or 'VAZIRLIGI' in line or user_data['university'].upper() in line:\n                        p.runs[0].font.bold = True\n            doc.add_page_break()\n        \n        elif section_type == 'plan':\n            p = doc.add_paragraph('REJA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    if line.startswith('I ') or line.startswith('II ') or line.startswith('III ') or line.isupper():\n                        p.runs[0].font.bold = True\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n                    else:\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n        elif section_type == 'intro':\n            p = doc.add_paragraph('KIRISH')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            p = doc.add_paragraph(content)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            p.paragraph_format.first_line_indent = Cm(1.25)\n            \n            # 1-2 ta snoska qo'shish\n            add_random_footnotes(p, 1, 2)\n            \n            doc.add_page_break()\n        \n        elif section_type in ['chapter1', 'chapter2', 'chapter3']:\n            title = section_data.get('title', 'BOB')\n            # Bob sarlavhasini katta harflar bilan yozish\n            p = doc.add_paragraph(title.upper())\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            \n            doc.add_paragraph()\n            \n            subsections = section_data.get('subsections', [])\n            for subsection in subsections:\n                subsection_title = f\"{subsection['number']}. {subsection['title']}\"\n                p = doc.add_paragraph(subsection_title)\n                p.runs[0].font.bold = True\n                p.runs[0].font.size = Pt(14)\n                p.runs[0].font.name = 'Times New Roman'\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                p.paragraph_format.space_before = Pt(12)\n                \n                subsection_content = subsection['content']\n                p = doc.add_paragraph(subsection_content)\n                p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                p.paragraph_format.first_line_indent = Cm(1.25)\n                \n                # 1-2 ta snoska qo'shish\n                add_random_footnotes(p, 1, 2)\n                \n                doc.add_paragraph()\n            \n            doc.add_page_break()\n        \n        elif section_type == 'conclusion':\n            p = doc.add_paragraph('XULOSA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            p = doc.add_paragraph(content)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            p.paragraph_format.first_line_indent = Cm(1.25)\n            \n            # 1-2 ta snoska qo'shish\n            add_random_footnotes(p, 1, 2)\n            \n            doc.add_page_break()\n        \n        elif section_type == 'references':\n            p = doc.add_paragraph('FOYDALANILGAN ADABIYOTLAR RO\\'YXATI')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n        elif section_type == 'appendix':\n            p = doc.add_paragraph('ILOVALAR')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    if line.endswith('ILOVA'):\n                        p.runs[0].font.bold = True\n                        p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                    else:\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n            doc.add_page_break()\n        \n        elif section_type == 'toc':\n            p = doc.add_paragraph('MUNDARIJA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line)\n                    if line.startswith('I ') or line.startswith('II ') or line.startswith('III ') or line.isupper():\n                        p.runs[0].font.bold = True\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n                    else:\n                        p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n    \n    doc.save(file_path)\n    return file_path\n\ndef create_pdf_document(sections, user_data, file_path):\n    c = canvas.Canvas(file_path, pagesize=A4)\n    width, height = A4\n    \n    left_margin = 30 * mm\n    right_margin = width - 15 * mm\n    top_margin = height - 20 * mm\n    bottom_margin = 20 * mm\n    \n    y_position = top_margin\n    font_size = 14\n    line_height = font_size * 1.5\n    \n    page_number = 1\n    \n    def add_page_number():\n        nonlocal page_number\n        c.setFont(\"Times-Roman\", 10)\n        c.drawString(width / 2, bottom_margin - 10, str(page_number))\n        page_number += 1\n    \n    def check_new_page():\n        nonlocal y_position\n        if y_position < bottom_margin + 50:\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n            return True\n        return False\n    \n    for section_data in sections:\n        section_type = section_data['type']\n        \n        if section_type == 'title_page':\n            content = section_data['content']\n            c.setFont(\"Times-Bold\", 14)\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    text_width = c.stringWidth(line, \"Times-Bold\", 14)\n                    x_position = (width - text_width) / 2\n                    c.drawString(x_position, y_position, line)\n                    y_position -= line_height\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['plan', 'intro', 'conclusion']:\n            if section_type == 'plan':\n                title = 'REJA'\n            elif section_type == 'intro':\n                title = 'KIRISH'\n            else:\n                title = 'XULOSA'\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            content = section_data['content']\n            c.setFont(\"Times-Roman\", 14)\n            \n            words = content.split()\n            line = \"\"\n            max_width = right_margin - left_margin\n            \n            for word in words:\n                test_line = line + word + \" \"\n                if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                    line = test_line\n                else:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height\n                    check_new_page()\n                    line = word + \" \"\n            \n            if line:\n                c.drawString(left_margin, y_position, line)\n                y_position -= line_height\n            \n            check_new_page()\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['chapter1', 'chapter2', 'chapter3']:\n            title = section_data.get('title', 'BOB')\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            subsections = section_data.get('subsections', [])\n            for subsection in subsections:\n                subsection_title = f\"{subsection['number']} {subsection['title']}\"\n                \n                c.setFont(\"Times-Bold\", 14)\n                c.drawString(left_margin, y_position, subsection_title)\n                y_position -= line_height * 1.5\n                check_new_page()\n                \n                subsection_content = subsection['content']\n                c.setFont(\"Times-Roman\", 14)\n                \n                words = subsection_content.split()\n                line = \"\"\n                max_width = right_margin - left_margin\n                \n                for word in words:\n                    test_line = line + word + \" \"\n                    if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                        line = test_line\n                    else:\n                        c.drawString(left_margin, y_position, line)\n                        y_position -= line_height\n                        check_new_page()\n                        line = word + \" \"\n                \n                if line:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height * 2\n                    check_new_page()\n            \n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n        \n        elif section_type in ['references', 'appendix', 'toc']:\n            if section_type == 'references':\n                title = 'FOYDALANILGAN ADABIYOTLAR RO\\'YXATI'\n            elif section_type == 'appendix':\n                title = 'ILOVALAR'\n            else:\n                title = 'MUNDARIJA'\n            \n            c.setFont(\"Times-Bold\", 14)\n            text_width = c.stringWidth(title, \"Times-Bold\", 14)\n            x_position = (width - text_width) / 2\n            c.drawString(x_position, y_position, title)\n            y_position -= line_height * 2\n            \n            content = section_data['content']\n            c.setFont(\"Times-Roman\", 14)\n            \n            words = content.split()\n            line = \"\"\n            max_width = right_margin - left_margin\n            \n            for word in words:\n                test_line = line + word + \" \"\n                if c.stringWidth(test_line, \"Times-Roman\", 14) < max_width:\n                    line = test_line\n                else:\n                    c.drawString(left_margin, y_position, line)\n                    y_position -= line_height\n                    check_new_page()\n                    line = word + \" \"\n            \n            if line:\n                c.drawString(left_margin, y_position, line)\n                y_position -= line_height\n            \n            check_new_page()\n            add_page_number()\n            c.showPage()\n            y_position = top_margin\n    \n    if page_number > 1:\n        add_page_number()\n    \n    c.save()\n    return file_path\n","size_bytes":15835},"utils/course_writer.py":{"content":"import os\nimport re\nimport asyncio\nfrom openai import OpenAI\n\nOPENAI_API_KEY = os.environ.get(\"OPENAI_API_KEY\")\nopenai_client = OpenAI(api_key=OPENAI_API_KEY)\n\n\ndef parse_plan(plan_content):\n    \"\"\"REJA dan bob va band sarlavhalarini ajratib olish\"\"\"\n    titles = {\n        'chapter1': {'title': 'I BOB. NAZARIY ASOSLAR VA ADABIYOTLAR TAHLILI', 'subsections': []},\n        'chapter2': {'title': 'II BOB. AMALIY TAHLIL VA TADQIQOT', 'subsections': []},\n        'chapter3': {'title': 'III BOB. TAKOMILLASHTIRISH TAKLIFLARI VA YECHIMLAR', 'subsections': []}\n    }\n    \n    lines = plan_content.split('\\n')\n    current_chapter = None\n    \n    for line in lines:\n        line = line.strip()\n        if not line:\n            continue\n            \n        # I BOB ni topish\n        if line.startswith('I BOB'):\n            titles['chapter1']['title'] = line\n            current_chapter = 'chapter1'\n        # II BOB ni topish\n        elif line.startswith('II BOB'):\n            titles['chapter2']['title'] = line\n            current_chapter = 'chapter2'\n        # III BOB ni topish\n        elif line.startswith('III BOB'):\n            titles['chapter3']['title'] = line\n            current_chapter = 'chapter3'\n        # 1.1, 1.2 kabi bandlarni topish\n        elif current_chapter and re.match(r'^\\d+\\.\\d+', line):\n            # \"1.1. Sarlavha\" formatidan faqat sarlavhani olish\n            parts = line.split('.', 2)  # \"1\", \"1\", \" Sarlavha\"\n            if len(parts) >= 3:\n                number = f\"{parts[0]}.{parts[1]}\"\n                title = parts[2].strip()\n                titles[current_chapter]['subsections'].append({\n                    'number': number,\n                    'title': title\n                })\n    \n    return titles\n\n\nasync def generate_course_work(user_data):\n    name = user_data['name']\n    university = user_data['university']\n    subject = user_data['subject']\n    topic = user_data['topic']\n    course = user_data['course']\n\n    sections = []\n\n    sections.append({\n        'type':\n        'title_page',\n        'content':\n        generate_title_page(name, university, subject, topic, course)\n    })\n\n    # REJA ni alohida thread'da yaratish (blocking'dan qochish)\n    loop = asyncio.get_event_loop()\n    plan_content = await loop.run_in_executor(None, generate_plan, subject, topic)\n    sections.append({'type': 'plan', 'content': plan_content})\n    \n    # REJA dan sarlavhalarni ajratib olish\n    plan_titles = parse_plan(plan_content)\n\n    intro_content = await generate_section_with_ai(\n        f\"Kurs ishi uchun KIRISH qismini yozing. Bu qism 4-5 betni tashkil qilishi kerak (taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"KIRISH qismida quyidagilarni JUDA BATAFSIL yozing:\\n\"\n        f\"1. Mavzuning dolzarbligi va ahamiyati (global va mahalliy kontekstda)\\n\"\n        f\"2. Tadqiqotning maqsadi va vazifalari (kamida 4-5 ta vazifa)\\n\"\n        f\"3. Tadqiqot ob'ekti va predmeti\\n\"\n        f\"4. Tadqiqot metodologiyasi\\n\"\n        f\"5. Ishning ilmiy va amaliy ahamiyati\\n\\n\"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"Matn to'liq, JUDA BATAFSIL va professional bo'lishi kerak. Har bir qismni chuqur va keng yoritib bering.\",\n        max_words=3000)\n    sections.append({'type': 'intro', 'content': intro_content})\n\n    chapter1_section1 = await generate_section_with_ai(\n        f\"Kurs ishi I BOB ning 1.1-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"1.1-band nazariy asoslar va tushunchalar bo'lishi kerak. \"\n        f\"Asosiy tushunchalar, ta'riflar, tarixiy rivojlanish va nazariy yondashuvlarni JUDA BATAFSIL bayon qiling. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"Har bir tushunchani chuqur va keng yoritib bering.\",\n        max_words=3200)\n\n    chapter1_section2 = await generate_section_with_ai(\n        f\"Kurs ishi I BOB ning 1.2-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"1.2-band xorijiy va mahalliy tajribalar tahlili bo'lishi kerak. \"\n        f\"Jahon va O'zbekiston amaliyotini qiyosiy tahlil qiling, adabiyotlar sharhi bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va professional bayon qiling.\",\n        max_words=3200)\n\n    # REJA dan olingan sarlavhalardan foydalanish\n    ch1_subsections = plan_titles['chapter1']['subsections']\n    sections.append({\n        'type': 'chapter1',\n        'title': plan_titles['chapter1']['title'],\n        'subsections': [{\n            'number': ch1_subsections[0]['number'] if len(ch1_subsections) > 0 else '1.1',\n            'title': ch1_subsections[0]['title'] if len(ch1_subsections) > 0 else 'Asosiy tushunchalar va nazariy asoslar',\n            'content': chapter1_section1\n        }, {\n            'number': ch1_subsections[1]['number'] if len(ch1_subsections) > 1 else '1.2',\n            'title': ch1_subsections[1]['title'] if len(ch1_subsections) > 1 else 'Xorijiy va mahalliy tajribalar tahlili',\n            'content': chapter1_section2\n        }]\n    })\n\n    chapter2_section1 = await generate_section_with_ai(\n        f\"Kurs ishi II BOB ning 2.1-bandini yozing (6-7 bet, taxminan 2000-2200 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"2.1-band amaliy tahlil va holat tadqiqi bo'lishi kerak. \"\n        f\"Joriy holat tahlili, muammolar va ularning sabablari, statistik ma'lumotlar va faktlar keltirilsin. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va chuqur tahlil qiling.\",\n        max_words=3500)\n\n    chapter2_section2 = await generate_section_with_ai(\n        f\"Kurs ishi II BOB ning 2.2-bandini yozing (6-7 bet, taxminan 2000-2200 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"2.2-band tendentsiyalar va rivojlanish yo'nalishlari tahlili bo'lishi kerak. \"\n        f\"Zamonaviy tendentsiyalar, texnologiyalar, innovatsiyalar va istiqbollarni batafsil tahlil qiling. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va professional bayon qiling.\",\n        max_words=3500)\n\n    ch2_subsections = plan_titles['chapter2']['subsections']\n    sections.append({\n        'type': 'chapter2',\n        'title': plan_titles['chapter2']['title'],\n        'subsections': [{\n            'number': ch2_subsections[0]['number'] if len(ch2_subsections) > 0 else '2.1',\n            'title': ch2_subsections[0]['title'] if len(ch2_subsections) > 0 else 'Amaliy tahlil va holat tadqiqi',\n            'content': chapter2_section1\n        }, {\n            'number': ch2_subsections[1]['number'] if len(ch2_subsections) > 1 else '2.2',\n            'title': ch2_subsections[1]['title'] if len(ch2_subsections) > 1 else 'Tendentsiyalar va rivojlanish yo\\'nalishlari',\n            'content': chapter2_section2\n        }]\n    })\n\n    chapter3_section1 = await generate_section_with_ai(\n        f\"Kurs ishi III BOB ning 3.1-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"3.1-band muammolarni yechish bo'yicha takliflar bo'lishi kerak. \"\n        f\"Aniqlangan muammolarni bartaraf etish uchun aniq, amaliy takliflar bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va amaliy yondashuvda bayon qiling.\",\n        max_words=3200)\n\n    chapter3_section2 = await generate_section_with_ai(\n        f\"Kurs ishi III BOB ning 3.2-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"3.2-band takomillashtirish choralari va istiqbollari bo'lishi kerak. \"\n        f\"Takliflarni amalga oshirish mexanizmlari, kutilayotgan natijalar va istiqbollarni batafsil yoritib bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va professional bayon qiling.\",\n        max_words=3200)\n\n    ch3_subsections = plan_titles['chapter3']['subsections']\n    sections.append({\n        'type': 'chapter3',\n        'title': plan_titles['chapter3']['title'],\n        'subsections': [{\n            'number': ch3_subsections[0]['number'] if len(ch3_subsections) > 0 else '3.1',\n            'title': ch3_subsections[0]['title'] if len(ch3_subsections) > 0 else 'Muammolarni yechish bo\\'yicha takliflar',\n            'content': chapter3_section1\n        }, {\n            'number': ch3_subsections[1]['number'] if len(ch3_subsections) > 1 else '3.2',\n            'title': ch3_subsections[1]['title'] if len(ch3_subsections) > 1 else 'Takomillashtirish choralari va istiqbollari',\n            'content': chapter3_section2\n        }]\n    })\n\n    conclusion_content = await generate_section_with_ai(\n        f\"Kurs ishi uchun XULOSA qismini yozing (4-5 bet, taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"XULOSA qismida:\\n\"\n        f\"1. Tadqiqotning asosiy natijalari va xulosalarini umumlashtiring\\n\"\n        f\"2. Har bir bobdan kelib chiqqan xulosalarni sanab o'ting\\n\"\n        f\"3. Amaliy takliflarning qisqacha xulosasini bering\\n\"\n        f\"4. Tadqiqotning ilmiy va amaliy ahamiyatini ta'kidlang\\n\\n\"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"JUDA BATAFSIL va chuqur xulosalar bering.\",\n        max_words=3000)\n    sections.append({'type': 'conclusion', 'content': conclusion_content})\n\n    # ADABIYOTLAR ni alohida thread'da yaratish (blocking'dan qochish)\n    references_content = await loop.run_in_executor(None, generate_references, subject, topic)\n    sections.append({'type': 'references', 'content': references_content})\n\n    appendix_content = generate_appendix()\n    sections.append({'type': 'appendix', 'content': appendix_content})\n    \n    toc_content = plan_content\n    sections.append({'type': 'toc', 'content': toc_content})\n\n    return sections\n\n\nasync def generate_section_with_ai(prompt, max_words=3000):\n    try:\n        # OpenAI chaqiruvini alohida thread'da ishga tushirish (blocking'dan qochish)\n        loop = asyncio.get_event_loop()\n        response = await loop.run_in_executor(\n            None,\n            lambda: openai_client.chat.completions.create(\n                model=\"gpt-4o-mini\",\n                messages=[{\n                    \"role\":\n                    \"system\",\n                    \"content\":\n                    \"Siz O'zbekiston oliygohlaridagi talabalar uchun kurs ishi yozuvchi sun'iy intellektsiz. \"\n                    \"Matnni to'liq, ilmiy uslubda, batafsil va professional darajada yozing. \"\n                    \"Matn bir oqimda, uzluksiz yozilishi kerak. Paragraflar orasiga qo'shimcha bo'shliq tashlamang. \"\n                    \"Har bir gap mantiqiy ravishda keyingi gapga bog'lanishi kerak.\"\n                }, {\n                    \"role\": \"user\",\n                    \"content\": prompt\n                }],\n                max_tokens=int(max_words * 1.5)\n            )\n        )\n        return response.choices[0].message.content\n    except Exception as e:\n        print(f\"AI xatolik: {e}\")\n        return f\"[AI bilan bog'lanishda xatolik yuz berdi: {str(e)}]\"\n\n\ndef generate_title_page(name, university, subject, topic, course):\n    return f\"\"\"O'ZBEKISTON RESPUBLIKASI OLIY VA O'RTA MAXSUS\nTA'LIM VAZIRLIGI\n\n{university.upper()}\n\n{subject.upper()} FANIDAN\n\nKURS ISHI\n\nMavzu: {topic}\n\nBajardi: {course}-kurs talabasi\n{name}\n\nQabul qildi: __________________\n\nToshkent â€“ 2025\n\"\"\"\n\n\ndef generate_plan(subject, topic):\n    \"\"\"Sinxron funksiya - faqat generate_course_work dan chaqiriladi\"\"\"\n    try:\n        prompt = f\"\"\"Fan: {subject}\nMavzu: {topic}\n\nYuqoridagi mavzu bo'yicha kurs ishi uchun REJA tuzing. \n\nReja quyidagi formatda bo'lishi kerak:\n\nKIRISH\n\nI BOB. [Mavzuga mos 1-bob sarlavhasi - NAZARIY ASOSLAR]\n1.1. [Mavzuga mos 1.1-band sarlavhasi]\n1.2. [Mavzuga mos 1.2-band sarlavhasi]\n\nII BOB. [Mavzuga mos 2-bob sarlavhasi - AMALIY TAHLIL]\n2.1. [Mavzuga mos 2.1-band sarlavhasi]\n2.2. [Mavzuga mos 2.2-band sarlavhasi]\n\nIII BOB. [Mavzuga mos 3-bob sarlavhasi - TAKLIFLAR]\n3.1. [Mavzuga mos 3.1-band sarlavhasi]\n3.2. [Mavzuga mos 3.2-band sarlavhasi]\n\nXULOSA\n\nFOYDALANILGAN ADABIYOTLAR RO'YXATI\n\nILOVALAR\n\nMUHIM: \n- Faqat rejani yozing, boshqa hech narsa yozilmasin\n- Har bir bob va band sarlavhasi mavzuga to'g'ridan-to'g'ri bog'liq bo'lishi kerak\n- Sarlavhalar aniq, qisqa va professional bo'lishi kerak\n- Faqat yuqoridagi formatda yozing\"\"\"\n\n        response = openai_client.chat.completions.create(\n            model=\"gpt-4o-mini\",\n            messages=[\n                {\n                    \"role\": \"system\",\n                    \"content\": \"Siz kurs ishi uchun professional reja tuzuvchisiz. Faqat reja matnini qaytaring, boshqa hech narsa yozmang.\"\n                },\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            max_tokens=500,\n            temperature=0.7\n        )\n        \n        plan = response.choices[0].message.content.strip()\n        return plan\n        \n    except Exception as e:\n        print(f\"Reja yaratishda xatolik: {e}\")\n        return \"\"\"KIRISH\n\nI BOB. NAZARIY ASOSLAR VA ADABIYOTLAR TAHLILI\n1.1. Asosiy tushunchalar va nazariy asoslar\n1.2. Xorijiy va mahalliy tajribalar tahlili\n\nII BOB. AMALIY TAHLIL VA TADQIQOT\n2.1. Amaliy tahlil va holat tadqiqi\n2.2. Tendentsiyalar va rivojlanish yo'nalishlari\n\nIII BOB. TAKOMILLASHTIRISH TAKLIFLARI VA YECHIMLAR\n3.1. Muammolarni yechish bo'yicha takliflar\n3.2. Takomillashtirish choralari va istiqbollari\n\nXULOSA\n\nFOYDALANILGAN ADABIYOTLAR RO'YXATI\n\nILOVALAR\"\"\"\n\n\ndef generate_references(subject, topic):\n    try:\n        prompt = f\"\"\"Fan: {subject}\nMavzu: {topic}\n\nYuqoridagi mavzu bo'yicha kurs ishi uchun FOYDALANILGAN ADABIYOTLAR RO'YXATI tuzing.\n\nAdabiyotlar ro'yxati quyidagilarni o'z ichiga olishi kerak:\n1. O'zbekiston qonunlari va me'yoriy hujjatlar (2-3 ta)\n2. O'zbek mualliflarining kitoblari (5-7 ta)\n3. Rus va xorijiy mualliflarning kitoblari (5-7 ta)\n4. Ilmiy jurnallar va maqolalar (3-5 ta)\n5. Internet manbalari (3-5 ta)\n\nJAMI: kamida 25 ta manba\n\nFormat:\n1. Muallif. Kitob nomi. â€“ Nashr: Nashriyot, yil.\n2. ...\n\nMUHIM:\n- Faqat adabiyotlar ro'yxatini yozing\n- Har bir manba mavzuga mos bo'lishi kerak\n- Manbalar haqiqiy ko'rinishda bo'lishi kerak (real muallif va kitob nomlari)\n- Kamida 25 ta manba bo'lishi shart\n- Raqamli tartibda yozing\"\"\"\n\n        response = openai_client.chat.completions.create(\n            model=\"gpt-4o-mini\",\n            messages=[\n                {\n                    \"role\": \"system\",\n                    \"content\": \"Siz kurs ishi uchun professional adabiyotlar ro'yxati tuzuvchisiz. Faqat adabiyotlar ro'yxatini qaytaring.\"\n                },\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            max_tokens=2000,\n            temperature=0.7\n        )\n        \n        references = response.choices[0].message.content.strip()\n        return references\n        \n    except Exception as e:\n        print(f\"Adabiyotlar yaratishda xatolik: {e}\")\n        return \"\"\"1. O'zbekiston Respublikasining Ta'lim to'g'risidagi Qonuni. â€“ T.: 2020.\n2. O'zbekiston Respublikasi Prezidentining Farmonlari va Qarorlari to'plami. â€“ T.: 2020-2025.\n3. Karimov I.A. Yuksak ma'naviyat â€“ yengilmas kuch. â€“ T.: Ma'naviyat, 2008.\n4. Mirziyoyev Sh.M. Tanqidiy tahlil, qat'iy tartib-intizom va shaxsiy javobgarlik â€“ har bir rahbar faoliyatining kundalik qoidasi bo'lishi kerak. â€“ T.: O'zbekiston, 2017.\n5. O'zbekiston milliy ensiklopediyasi. â€“ T.: 2000-2006.\n6. Internet manbalari: www.lex.uz, www.press-service.uz, www.ziyonet.uz\n7. Maxsus adabiyotlar va ilmiy jurnallar.\"\"\"\n\n\ndef generate_appendix():\n    return \"\"\"1-ILOVA\n\nJadval va diagrammalar\n\n[Bu yerda tadqiqot natijalari bo'yicha jadvallar va grafiklar joylashtiriladi]\n\n2-ILOVA\n\nQo'shimcha materiallar\n\n[Bu yerda qo'shimcha hujjatlar va materiallar joylashtiriladi]\"\"\"\n","size_bytes":16140},"database.py":{"content":"import sqlite3\nimport logging\nfrom datetime import datetime\nfrom typing import Optional, List, Dict, Any\n\nlogger = logging.getLogger(__name__)\n\nclass Database:\n    def __init__(self, db_name: str = \"bot_database.db\"):\n        self.db_name = db_name\n        self.init_db()\n    \n    def get_connection(self):\n        return sqlite3.connect(self.db_name)\n    \n    def init_db(self):\n        \"\"\"Ma'lumotlar bazasini yaratish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS users (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            telegram_id INTEGER UNIQUE NOT NULL,\n            username TEXT,\n            full_name TEXT,\n            balance INTEGER DEFAULT 0,\n            referal_code TEXT UNIQUE,\n            invited_by INTEGER,\n            register_date TEXT NOT NULL,\n            is_blocked INTEGER DEFAULT 0\n        )\n        \"\"\")\n        \n        # Eski foydalanuvchilar uchun is_blocked ustunini qo'shish (agar mavjud bo'lmasa)\n        try:\n            cursor.execute(\"ALTER TABLE users ADD COLUMN is_blocked INTEGER DEFAULT 0\")\n            conn.commit()\n        except sqlite3.OperationalError:\n            pass\n        \n        cursor.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS orders (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER NOT NULL,\n            type TEXT NOT NULL,\n            topic TEXT NOT NULL,\n            price INTEGER NOT NULL,\n            file_link TEXT,\n            created_at TEXT NOT NULL,\n            FOREIGN KEY (user_id) REFERENCES users (telegram_id)\n        )\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS payments (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            user_id INTEGER NOT NULL,\n            amount INTEGER NOT NULL,\n            status TEXT DEFAULT 'pending',\n            check_photo_link TEXT,\n            created_at TEXT NOT NULL,\n            FOREIGN KEY (user_id) REFERENCES users (telegram_id)\n        )\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS promocodes (\n            id INTEGER PRIMARY KEY AUTOINCREMENT,\n            code TEXT UNIQUE NOT NULL,\n            work_type TEXT NOT NULL,\n            discount_percent INTEGER NOT NULL,\n            usage_type TEXT DEFAULT 'unlimited',\n            used_by TEXT DEFAULT '[]',\n            expiry_date TEXT,\n            active INTEGER DEFAULT 1\n        )\n        \"\"\")\n        \n        # Eski promokodlar uchun yangi ustunlarni qo'shish\n        try:\n            cursor.execute(\"ALTER TABLE promocodes ADD COLUMN usage_type TEXT DEFAULT 'unlimited'\")\n            conn.commit()\n        except sqlite3.OperationalError:\n            pass\n        \n        try:\n            cursor.execute(\"ALTER TABLE promocodes ADD COLUMN used_by TEXT DEFAULT '[]'\")\n            conn.commit()\n        except sqlite3.OperationalError:\n            pass\n        \n        cursor.execute(\"\"\"\n        CREATE TABLE IF NOT EXISTS settings (\n            key TEXT PRIMARY KEY,\n            value TEXT NOT NULL\n        )\n        \"\"\")\n        \n        conn.commit()\n        conn.close()\n        logger.info(\"Ma'lumotlar bazasi muvaffaqiyatli yaratildi\")\n    \n    def add_user(self, telegram_id: int, username: str, full_name: str, invited_by: Optional[int] = None) -> bool:\n        \"\"\"Yangi foydalanuvchi qo'shish\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            referal_code = f\"REF{telegram_id}\"\n            register_date = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n            \n            cursor.execute(\"\"\"\n            INSERT INTO users (telegram_id, username, full_name, referal_code, invited_by, register_date)\n            VALUES (?, ?, ?, ?, ?, ?)\n            \"\"\", (telegram_id, username, full_name, referal_code, invited_by, register_date))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except sqlite3.IntegrityError:\n            return False\n    \n    def get_user(self, telegram_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"Foydalanuvchi ma'lumotlarini olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM users WHERE telegram_id = ?\", (telegram_id,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        if row:\n            return {\n                \"id\": row[0],\n                \"telegram_id\": row[1],\n                \"username\": row[2],\n                \"full_name\": row[3],\n                \"balance\": row[4],\n                \"referal_code\": row[5],\n                \"invited_by\": row[6],\n                \"register_date\": row[7],\n                \"is_blocked\": row[8]\n            }\n        return None\n    \n    def update_balance(self, telegram_id: int, amount: int) -> bool:\n        \"\"\"Balansni yangilash\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"\"\"\n            UPDATE users SET balance = balance + ? WHERE telegram_id = ?\n            \"\"\", (amount, telegram_id))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Balansni yangilashda xatolik: {e}\")\n            return False\n    \n    def add_order(self, user_id: int, order_type: str, topic: str, price: int, file_link: str = \"\") -> int:\n        \"\"\"Yangi buyurtma qo'shish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        created_at = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n        \n        cursor.execute(\"\"\"\n        INSERT INTO orders (user_id, type, topic, price, file_link, created_at)\n        VALUES (?, ?, ?, ?, ?, ?)\n        \"\"\", (user_id, order_type, topic, price, file_link, created_at))\n        \n        order_id = cursor.lastrowid\n        conn.commit()\n        conn.close()\n        return order_id\n    \n    def add_payment(self, user_id: int, amount: int, check_photo_link: str) -> int:\n        \"\"\"To'lov qo'shish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        created_at = datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n        \n        cursor.execute(\"\"\"\n        INSERT INTO payments (user_id, amount, status, check_photo_link, created_at)\n        VALUES (?, ?, 'pending', ?, ?)\n        \"\"\", (user_id, amount, check_photo_link, created_at))\n        \n        payment_id = cursor.lastrowid\n        conn.commit()\n        conn.close()\n        return payment_id\n    \n    def update_payment_status(self, payment_id: int, status: str) -> bool:\n        \"\"\"To'lov statusini yangilash\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"\"\"\n            UPDATE payments SET status = ? WHERE id = ?\n            \"\"\", (status, payment_id))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"To'lov statusini yangilashda xatolik: {e}\")\n            return False\n    \n    def get_payment(self, payment_id: int) -> Optional[Dict[str, Any]]:\n        \"\"\"To'lov ma'lumotlarini olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM payments WHERE id = ?\", (payment_id,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        if row:\n            return {\n                \"id\": row[0],\n                \"user_id\": row[1],\n                \"amount\": row[2],\n                \"status\": row[3],\n                \"check_photo_link\": row[4],\n                \"created_at\": row[5]\n            }\n        return None\n    \n    def add_promocode(self, code: str, work_type: str, discount_percent: int, expiry_date: str = None, usage_type: str = \"unlimited\") -> bool:\n        \"\"\"Promokod qo'shish\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"\"\"\n            INSERT INTO promocodes (code, work_type, discount_percent, expiry_date, usage_type, used_by)\n            VALUES (?, ?, ?, ?, ?, '[]')\n            \"\"\", (code, work_type, discount_percent, expiry_date, usage_type))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except sqlite3.IntegrityError:\n            return False\n    \n    def get_promocode(self, code: str) -> Optional[Dict[str, Any]]:\n        \"\"\"Promokod ma'lumotlarini olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM promocodes WHERE code = ? AND active = 1\", (code,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        if row:\n            return {\n                \"id\": row[0],\n                \"code\": row[1],\n                \"work_type\": row[2],\n                \"discount_percent\": row[3],\n                \"expiry_date\": row[4] if len(row) > 4 else None,\n                \"active\": row[5] if len(row) > 5 else 1,\n                \"usage_type\": row[6] if len(row) > 6 else \"unlimited\",\n                \"used_by\": row[7] if len(row) > 7 else \"[]\"\n            }\n        return None\n    \n    def get_all_promocodes(self) -> list:\n        \"\"\"Barcha promokodlarni olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM promocodes ORDER BY id DESC\")\n        rows = cursor.fetchall()\n        conn.close()\n        \n        promocodes = []\n        for row in rows:\n            promocodes.append({\n                \"id\": row[0],\n                \"code\": row[1],\n                \"work_type\": row[2],\n                \"discount_percent\": row[3],\n                \"expiry_date\": row[4] if len(row) > 4 else None,\n                \"active\": row[5] if len(row) > 5 else 1,\n                \"usage_type\": row[6] if len(row) > 6 else \"unlimited\",\n                \"used_by\": row[7] if len(row) > 7 else \"[]\"\n            })\n        \n        return promocodes\n    \n    def delete_promocode(self, promo_id: int) -> bool:\n        \"\"\"Promokodni o'chirish\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"DELETE FROM promocodes WHERE id = ?\", (promo_id,))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Promokod o'chirishda xatolik: {e}\")\n            return False\n    \n    def get_setting(self, key: str, default: str = \"\") -> str:\n        \"\"\"Sozlama olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT value FROM settings WHERE key = ?\", (key,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        return row[0] if row else default\n    \n    def set_setting(self, key: str, value: str) -> bool:\n        \"\"\"Sozlama o'rnatish\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"\"\"\n            INSERT OR REPLACE INTO settings (key, value) VALUES (?, ?)\n            \"\"\", (key, value))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Sozlama o'rnatishda xatolik: {e}\")\n            return False\n    \n    def get_referal_count(self, telegram_id: int) -> int:\n        \"\"\"Referal sonini olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT COUNT(*) FROM users WHERE invited_by = ?\", (telegram_id,))\n        result = cursor.fetchone()\n        count = result[0] if result else 0\n        conn.close()\n        \n        return count\n    \n    def get_all_users(self) -> List[int]:\n        \"\"\"Barcha foydalanuvchilar ID sini olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT telegram_id FROM users\")\n        result = cursor.fetchall()\n        users = [row[0] for row in result if row]\n        conn.close()\n        \n        return users\n    \n    def mark_user_as_blocked(self, telegram_id: int) -> bool:\n        \"\"\"Foydalanuvchini blok deb belgilash\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"UPDATE users SET is_blocked = 1 WHERE telegram_id = ?\", (telegram_id,))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Foydalanuvchini blok deb belgilashda xatolik: {e}\")\n            return False\n    \n    def unmark_user_as_blocked(self, telegram_id: int) -> bool:\n        \"\"\"Foydalanuvchini faol deb belgilash (unblock)\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"UPDATE users SET is_blocked = 0 WHERE telegram_id = ?\", (telegram_id,))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Foydalanuvchini faol deb belgilashda xatolik: {e}\")\n            return False\n    \n    def get_statistics(self) -> Dict[str, int]:\n        \"\"\"Statistika olish\"\"\"\n        conn = self.get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT COUNT(*) FROM users\")\n        total_users = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM users WHERE is_blocked = 1\")\n        blocked_users = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM orders WHERE type = 'kurs_ishi'\")\n        kurs_ishlari = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM orders WHERE type = 'maqola'\")\n        maqolalar = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM orders\")\n        total_orders = cursor.fetchone()[0]\n        \n        conn.close()\n        \n        return {\n            \"total_users\": total_users,\n            \"blocked_users\": blocked_users,\n            \"kurs_ishlari\": kurs_ishlari,\n            \"maqolalar\": maqolalar,\n            \"total_orders\": total_orders\n        }\n    \n    def ban_user(self, telegram_id: int) -> bool:\n        \"\"\"Foydalanuvchini cheklash\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"UPDATE users SET is_blocked = 1 WHERE telegram_id = ?\", (telegram_id,))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Ban user error: {e}\")\n            return False\n    \n    def unban_user(self, telegram_id: int) -> bool:\n        \"\"\"Foydalanuvchi cheklovini olib tashlash\"\"\"\n        try:\n            conn = self.get_connection()\n            cursor = conn.cursor()\n            \n            cursor.execute(\"UPDATE users SET is_blocked = 0 WHERE telegram_id = ?\", (telegram_id,))\n            \n            conn.commit()\n            conn.close()\n            return True\n        except Exception as e:\n            logger.error(f\"Unban user error: {e}\")\n            return False\n    \n    def is_user_banned(self, telegram_id: int) -> bool:\n        \"\"\"Foydalanuvchi cheklangan yoki yo'qligini tekshirish\"\"\"\n        user = self.get_user(telegram_id)\n        if user:\n            return user.get('is_blocked', 0) == 1\n        return False\n","size_bytes":15610},"handlers/user_handlers.py":{"content":"from aiogram import Router, F\nfrom aiogram.types import Message, CallbackQuery, FSInputFile\nfrom aiogram.filters import Command, StateFilter\nfrom aiogram.fsm.context import FSMContext\nfrom aiogram.fsm.state import State, StatesGroup\nfrom datetime import datetime\nimport logging\nimport asyncio\nimport os\n\nfrom database import Database\nfrom keyboards import (get_main_menu, get_cancel_button, get_balance_buttons, \n                        get_service_info_buttons, get_payment_amount_buttons, get_support_buttons,\n                        get_pdf_convert_button)\nfrom utils.course_writer import generate_course_work\nfrom utils.document_generator import create_word_document\nfrom utils.article_writer import generate_article\nfrom utils.article_document_generator import create_article_document\nimport config\n\nlogger = logging.getLogger(__name__)\n\nrouter = Router()\ndb = Database()\n\n# Background task yaratish uchun\nasync def process_course_work_background(bot, telegram_id, user_data_for_ai, price, data):\n    \"\"\"Background da kurs ishini yaratish\"\"\"\n    try:\n        sections = await generate_course_work(user_data_for_ai)\n        \n        filename = f\"kurs_ishi_{telegram_id}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.docx\"\n        os.makedirs('generated_files', exist_ok=True)\n        docx_path = os.path.join('generated_files', filename)\n        \n        create_word_document(sections, user_data_for_ai, docx_path)\n        \n        db.update_balance(telegram_id, -price)\n        \n        document_file = FSInputFile(docx_path)\n        \n        if config.KURS_ISHLARI_CHANNEL_ID:\n            channel_message = await bot.send_document(\n                chat_id=config.KURS_ISHLARI_CHANNEL_ID,\n                document=document_file,\n                caption=f\"\"\"ğŸ§¾ Kurs ishi tayyorlandi\n\nğŸ‘¤ F.I.Sh: {data['fish']}\nğŸ†” ID: {telegram_id}\nğŸ« O'quv yurti: {data['university']}\nğŸ“– Fan: {data['subject']}\nğŸ“š Mavzu: {data['topic']}\nğŸ“ Kurs: {user_data_for_ai['course']}\nğŸ’° Narx: {price:,} so'm\nğŸ•’ Sana: {datetime.now().strftime('%Y-%m-%d %H:%M')}\"\"\"\n            )\n            file_link = f\"https://t.me/c/{str(config.KURS_ISHLARI_CHANNEL_ID)[4:]}/{channel_message.message_id}\"\n        else:\n            file_link = docx_path\n        \n        document_file_user = FSInputFile(docx_path)\n        \n        info_text = (\n            f\"âœ… Kurs ishingiz tayyor!\\n\\n\"\n            f\"ğŸ“š Mavzu: {data['topic']}\\n\"\n            f\"ğŸ’° To'langan: {price:,} so'm\\n\\n\"\n            f\"ğŸ“ **Fayl haqida:**\\n\"\n            f\"â€¢ Fayl Word (DOCX) formatda\\n\"\n            f\"â€¢ Kompyuterda Word orqali ochib o'zgartirish kiritishingiz mumkin\\n\"\n            f\"â€¢ Agar telefoningizda ochilmasa yoki xato ko'rsatsa, pastdagi tugma orqali PDF qiling va ko'ring\"\n        )\n        \n        await bot.send_document(\n            chat_id=telegram_id,\n            document=document_file_user,\n            caption=info_text,\n            parse_mode=\"Markdown\",\n            reply_markup=get_pdf_convert_button(docx_path)\n        )\n        \n        db.add_order(telegram_id, \"kurs_ishi\", data['topic'], price, file_link)\n        \n        # Faylni serverdan o'chirish (joy tejash uchun)\n        try:\n            os.remove(docx_path)\n            logger.info(f\"DOCX fayl o'chirildi: {docx_path}\")\n        except Exception as e:\n            logger.error(f\"Faylni o'chirishda xatolik: {e}\")\n        \n        logger.info(f\"Kurs ishi tayyor: {telegram_id}\")\n        \n    except Exception as e:\n        logger.error(f\"Kurs ishi yaratishda xatolik: {e}\")\n        await bot.send_message(\n            chat_id=telegram_id,\n            text=f\"âŒ Kurs ishi tayyorlashda xatolik yuz berdi: {str(e)}\\n\\n\"\n                 \"Balansingiz o'zgartirilmadi. Iltimos, keyinroq qayta urinib ko'ring.\",\n            reply_markup=get_main_menu()\n        )\n\nasync def process_article_background(bot, telegram_id, user_data_for_ai, price, topic):\n    \"\"\"Background da maqolani yaratish\"\"\"\n    try:\n        sections = await generate_article(user_data_for_ai)\n        \n        filename = f\"maqola_{telegram_id}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.docx\"\n        os.makedirs('generated_files', exist_ok=True)\n        filepath = os.path.join('generated_files', filename)\n        \n        create_article_document(sections, user_data_for_ai, filepath)\n        \n        db.update_balance(telegram_id, -price)\n        \n        document_file = FSInputFile(filepath)\n        \n        user = db.get_user(telegram_id)\n        \n        if config.MAQOLALAR_CHANNEL_ID:\n            channel_message = await bot.send_document(\n                chat_id=config.MAQOLALAR_CHANNEL_ID,\n                document=document_file,\n                caption=f\"\"\"ğŸ“° Maqola tayyorlandi\n\nğŸ‘¤ Ismi: {user['full_name']}\nğŸ†” ID: {telegram_id}\nğŸ”— Username: @{user['username'] or 'mavjud emas'}\nğŸ“ Mavzu: {topic}\nğŸ’° Narx: {price:,} so'm\nğŸ•’ Sana: {datetime.now().strftime('%Y-%m-%d %H:%M')}\"\"\"\n            )\n            file_link = f\"https://t.me/c/{str(config.MAQOLALAR_CHANNEL_ID)[4:]}/{channel_message.message_id}\"\n        else:\n            file_link = filepath\n        \n        document_file_user = FSInputFile(filepath)\n        \n        info_text = (\n            f\"âœ… Maqolangiz tayyor!\\n\\n\"\n            f\"ğŸ“ Mavzu: {topic}\\n\"\n            f\"ğŸ’° To'langan: {price:,} so'm\\n\\n\"\n            f\"ğŸ“ **Fayl haqida:**\\n\"\n            f\"â€¢ Fayl Word (DOCX) formatda\\n\"\n            f\"â€¢ Kompyuterda Word orqali ochib o'zgartirish kiritishingiz mumkin\\n\"\n            f\"â€¢ Agar telefoningizda ochilmasa yoki xato ko'rsatsa, pastdagi tugma orqali PDF qiling va ko'ring\"\n        )\n        \n        await bot.send_document(\n            chat_id=telegram_id,\n            document=document_file_user,\n            caption=info_text,\n            parse_mode=\"Markdown\",\n            reply_markup=get_pdf_convert_button(filepath)\n        )\n        \n        db.add_order(telegram_id, \"maqola\", topic, price, file_link)\n        \n        # Faylni serverdan o'chirish (joy tejash uchun)\n        try:\n            os.remove(filepath)\n            logger.info(f\"DOCX fayl o'chirildi: {filepath}\")\n        except Exception as e:\n            logger.error(f\"Faylni o'chirishda xatolik: {e}\")\n        \n        logger.info(f\"Maqola tayyor: {telegram_id}\")\n        \n    except Exception as e:\n        logger.error(f\"Maqola yaratishda xatolik: {e}\")\n        await bot.send_message(\n            chat_id=telegram_id,\n            text=\"âŒ Maqola tayyorlashda xatolik yuz berdi. Iltimos, keyinroq qayta urinib ko'ring.\\n\\n\"\n                 \"Balansingiz o'zgartirilmadi.\",\n            reply_markup=get_main_menu()\n        )\n\nclass UserStates(StatesGroup):\n    waiting_for_kurs_topic = State()\n    waiting_for_kurs_fish = State()\n    waiting_for_kurs_university = State()\n    waiting_for_kurs_subject = State()\n    waiting_for_kurs_course_number = State()\n    waiting_for_maqola_topic = State()\n    waiting_for_maqola_author_name = State()\n    waiting_for_maqola_field_position = State()\n    waiting_for_maqola_supervisor = State()\n    waiting_for_payment_amount = State()\n    waiting_for_payment_check = State()\n    waiting_for_promocode = State()\n\n@router.message(Command(\"start\"))\nasync def cmd_start(message: Message):\n    \"\"\"Start buyrug'i\"\"\"\n    telegram_id = message.from_user.id\n    username = message.from_user.username or \"\"\n    full_name = message.from_user.full_name or \"Foydalanuvchi\"\n    \n    # Foydalanuvchi cheklangan yoki yo'qligini tekshirish\n    if db.is_user_banned(telegram_id):\n        await message.answer(\n            \"ğŸš« **Sizning botdan foydalanish huquqingiz yo'q.**\\n\\n\"\n            \"Agar bu xato deb hisoblasangiz yoki huquqni qaytadan olish uchun \"\n            \"qo'llab-quvvatlash guruhiga murojaat qiling:\",\n            reply_markup=get_support_buttons(config.SUPPORT_GROUP_URL),\n            parse_mode=\"Markdown\"\n        )\n        return\n    \n    args = message.text.split()\n    invited_by = None\n    \n    if len(args) > 1 and args[1].startswith(\"REF\"):\n        try:\n            invited_by = int(args[1].replace(\"REF\", \"\"))\n            referal_bonus = int(db.get_setting(\"referal_bonus\", str(config.DEFAULT_REFERAL_BONUS)))\n            db.update_balance(invited_by, referal_bonus)\n        except:\n            pass\n    \n    user = db.get_user(telegram_id)\n    \n    if not user:\n        db.add_user(telegram_id, username, full_name, invited_by)\n        welcome_text = f\"\"\"ğŸ‰ Xush kelibsiz, {full_name}!\n\nMen sizga kurs ishi va maqola tayyorlashda yordam beraman.\n\nğŸ”¹ Kurs ishi yozish - akademik kurs ishi tayyorlash\nğŸ”¹ Maqola yozish - ilmiy maqola tayyorlash\nğŸ”¹ Balansim - hisobingizni to'ldirish va ko'rish\nğŸ”¹ Pul ishlash - referal orqali bonus olish\nğŸ”¹ Profil - shaxsiy ma'lumotlaringiz\nğŸ”¹ Promokodlarim - chegirmalardan foydalanish\n\nBoshlash uchun quyidagi tugmalardan birini tanlang! ğŸ‘‡\"\"\"\n    else:\n        welcome_text = f\"Qaytganingizdan xursandmiz, {full_name}! ğŸ˜Š\\n\\nQuyidagi tugmalardan birini tanlang:\"\n    \n    await message.answer(welcome_text, reply_markup=get_main_menu())\n\n@router.message(F.text == \"ğŸ§¾ Kurs ishi yozish\")\nasync def kurs_ishi_handler(message: Message, state: FSMContext):\n    \"\"\"Kurs ishi yozish - narx va ma'lumot\"\"\"\n    kurs_ishi_price = int(db.get_setting(\"kurs_ishi_price\", \"50000\"))\n    \n    info_text = (\n        \"ğŸ§¾ **Kurs ishi yozish**\\n\\n\"\n        \"ğŸ“Š **Xizmat haqida:**\\n\"\n        \"â€¢ Professional akademik kurs ishi\\n\"\n        \"â€¢ 40-45 sahifa (16,000-17,000 so'z)\\n\"\n        \"â€¢ GPT-4o Mini yordamida yaratiladi\\n\"\n        \"â€¢ O'zbekiston standartlariga mos\\n\"\n        \"â€¢ Titul, Reja, Mundarija, Ilovalar\\n\"\n        \"â€¢ Times New Roman 14pt, 1.5 interval\\n\\n\"\n        f\"ğŸ’° **Narx:** {kurs_ishi_price:,} so'm\\n\\n\"\n        \"â± **Tayyor bo'lish muddati:** 15-30 daqiqa\\n\\n\"\n        \"ğŸ“„ Namunani ko'rish uchun tugmani bosing.\"\n    )\n    \n    await message.answer(\n        info_text,\n        reply_markup=get_service_info_buttons(\"kurs\", config.KURS_ISHI_SAMPLE_URL),\n        parse_mode=\"Markdown\"\n    )\n\n@router.message(UserStates.waiting_for_kurs_fish)\nasync def process_kurs_fish(message: Message, state: FSMContext):\n    \"\"\"F.I.Sh qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(fish=message.text)\n    await message.answer(\n        \"ğŸ« O'quv yurti nomini kiriting:\\n\\n\"\n        \"Masalan: Toshkent Davlat Texnika Universiteti\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_kurs_university)\n\n@router.message(UserStates.waiting_for_kurs_university)\nasync def process_kurs_university(message: Message, state: FSMContext):\n    \"\"\"O'quv yurti nomini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(university=message.text)\n    await message.answer(\n        \"ğŸ“– Fan nomini kiriting:\\n\\n\"\n        \"Masalan: Axborot texnologiyalari\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_kurs_subject)\n\n@router.message(UserStates.waiting_for_kurs_subject)\nasync def process_kurs_subject(message: Message, state: FSMContext):\n    \"\"\"Fan nomini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(subject=message.text)\n    await message.answer(\n        \"ğŸ“š Kurs ishi mavzusini kiriting:\\n\\n\"\n        \"Masalan: Sun'iy intellektning iqtisodiy rivojlanishga ta'siri\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_kurs_topic)\n\n@router.message(UserStates.waiting_for_kurs_topic)\nasync def process_kurs_topic(message: Message, state: FSMContext):\n    \"\"\"Mavzuni qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(topic=message.text)\n    await message.answer(\n        \"ğŸ“ Kurs raqamini kiriting (1, 2, 3 yoki 4):\\n\\n\"\n        \"Masalan: 3\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_kurs_course_number)\n\n@router.message(UserStates.waiting_for_kurs_course_number)\nasync def process_kurs_course_number(message: Message, state: FSMContext, bot):\n    \"\"\"Kurs raqamini qabul qilish va ishni yaratish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    try:\n        course_number = int(message.text)\n        if course_number not in [1, 2, 3, 4]:\n            await message.answer(\"âŒ Kurs raqami 1, 2, 3 yoki 4 bo'lishi kerak.\")\n            return\n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting (1, 2, 3 yoki 4).\")\n        return\n    \n    await state.update_data(course_number=course_number)\n    \n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        await state.clear()\n        return\n    \n    price = int(db.get_setting(\"kurs_ishi_price\", str(config.DEFAULT_KURS_ISH_PRICE)))\n    \n    if user[\"balance\"] < price:\n        await message.answer(\n            f\"âŒ Balansingizda mablag' yetarli emas!\\n\\n\"\n            f\"Kerakli summa: {price:,} so'm\\n\"\n            f\"Sizning balansingiz: {user['balance']:,} so'm\\n\\n\"\n            f\"Iltimos, avval balansni to'ldiring.\",\n            reply_markup=get_main_menu()\n        )\n        await state.clear()\n        return\n    \n    data = await state.get_data()\n    \n    await message.answer(\n        f\"âœ… Ma'lumotlar qabul qilindi!\\n\\n\"\n        f\"ğŸ‘¤ F.I.Sh: {data['fish']}\\n\"\n        f\"ğŸ« O'quv yurti: {data['university']}\\n\"\n        f\"ğŸ“– Fan: {data['subject']}\\n\"\n        f\"ğŸ“š Mavzu: {data['topic']}\\n\"\n        f\"ğŸ“ Kurs: {course_number}\\n\\n\"\n        f\"â³ Kurs ishingiz tayyorlanmoqda...\\n\"\n        f\"ğŸ“² Tayyor bo'lgach sizga yuboriladi (2-3 daqiqa)\\n\\n\"\n        f\"Shu vaqt ichida botning boshqa funksiyalaridan foydalanishingiz mumkin!\",\n        reply_markup=get_main_menu()\n    )\n    \n    user_data_for_ai = {\n        'name': data['fish'],\n        'university': data['university'],\n        'subject': data['subject'],\n        'topic': data['topic'],\n        'course': course_number\n    }\n    \n    # Background task yaratish\n    asyncio.create_task(\n        process_course_work_background(bot, telegram_id, user_data_for_ai, price, data)\n    )\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ“° Maqola yozish\")\nasync def maqola_handler(message: Message, state: FSMContext):\n    \"\"\"Maqola yozish - narx va ma'lumot\"\"\"\n    maqola_price = int(db.get_setting(\"maqola_price\", \"30000\"))\n    \n    info_text = (\n        \"ğŸ“° **Ilmiy maqola yozish**\\n\\n\"\n        \"ğŸ“Š **Xizmat haqida:**\\n\"\n        \"â€¢ Professional ilmiy maqola\\n\"\n        \"â€¢ 7-10 sahifa\\n\"\n        \"â€¢ GPT-4o Mini yordamida yaratiladi\\n\"\n        \"â€¢ Annotatsiya (3 tilda: O'zbek, Ingliz, Rus)\\n\"\n        \"â€¢ Kalit so'zlar, Adabiyotlar (APA format)\\n\"\n        \"â€¢ Times New Roman 14pt, 1.5 interval\\n\\n\"\n        f\"ğŸ’° **Narx:** {maqola_price:,} so'm\\n\\n\"\n        \"â± **Tayyor bo'lish muddati:** 10-20 daqiqa\\n\\n\"\n        \"ğŸ“„ Namunani ko'rish uchun tugmani bosing.\"\n    )\n    \n    await message.answer(\n        info_text,\n        reply_markup=get_service_info_buttons(\"maqola\", config.MAQOLA_SAMPLE_URL),\n        parse_mode=\"Markdown\"\n    )\n\n@router.message(UserStates.waiting_for_maqola_topic)\nasync def process_maqola_topic(message: Message, state: FSMContext):\n    \"\"\"Maqola mavzusini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(topic=message.text)\n    await message.answer(\n        \"ğŸ‘¤ Ism va familiyangizni kiriting:\\n\\n\"\n        \"Masalan: Akmal Abdullayev\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_maqola_author_name)\n\n@router.message(UserStates.waiting_for_maqola_author_name)\nasync def process_maqola_author_name(message: Message, state: FSMContext):\n    \"\"\"Muallif ismini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(author_name=message.text)\n    await message.answer(\n        \"ğŸ“š Sohangiz va lavozimingizni kiriting:\\n\\n\"\n        \"Masalan: Matematika, Katta o'qituvchi\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_maqola_field_position)\n\n@router.message(UserStates.waiting_for_maqola_field_position)\nasync def process_maqola_field_position(message: Message, state: FSMContext):\n    \"\"\"Soha va lavozimni qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    await state.update_data(field_position=message.text)\n    \n    from keyboards import get_skip_button\n    await message.answer(\n        \"ğŸ‘¨â€ğŸ« Siz bilan ishlaydigan ustoz ism va familiyasini kiriting:\\n\\n\"\n        \"Masalan: Rustam Karimov\\n\\n\"\n        \"Agar ustozingiz bo'lmasa, 'O'tkazib yuborish' tugmasini bosing.\",\n        reply_markup=get_skip_button()\n    )\n    await state.set_state(UserStates.waiting_for_maqola_supervisor)\n\n@router.message(UserStates.waiting_for_maqola_supervisor)\nasync def process_maqola_supervisor(message: Message, state: FSMContext, bot):\n    \"\"\"Ustoz ma'lumotini qabul qilish va maqolani yaratish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        await state.clear()\n        return\n    \n    price = int(db.get_setting(\"maqola_price\", str(config.DEFAULT_MAQOLA_PRICE)))\n    \n    if user[\"balance\"] < price:\n        await message.answer(\n            f\"âŒ Balansingizda mablag' yetarli emas!\\n\\n\"\n            f\"Kerakli summa: {price:,} so'm\\n\"\n            f\"Sizning balansingiz: {user['balance']:,} so'm\\n\\n\"\n            f\"Iltimos, avval balansni to'ldiring.\",\n            reply_markup=get_main_menu()\n        )\n        await state.clear()\n        return\n    \n    data = await state.get_data()\n    \n    # Ustozni saqlash (yoki bo'sh qoldirish)\n    supervisor = None if message.text == \"â­ O'tkazib yuborish\" else message.text\n    await state.update_data(supervisor=supervisor)\n    \n    data = await state.get_data()\n    topic = data['topic']\n    author_name = data['author_name']\n    field_position = data['field_position']\n    \n    # Ma'lumotlarni ko'rsatish\n    confirmation_text = f\"âœ… Ma'lumotlar qabul qilindi!\\n\\n\"\n    confirmation_text += f\"ğŸ“ Mavzu: {topic}\\n\"\n    confirmation_text += f\"ğŸ‘¤ Muallif: {author_name}\\n\"\n    confirmation_text += f\"ğŸ“š Soha va lavozim: {field_position}\\n\"\n    if supervisor:\n        confirmation_text += f\"ğŸ‘¨â€ğŸ« Ustoz: {supervisor}\\n\"\n    confirmation_text += f\"\\nâ³ Maqolangiz tayyorlanmoqda...\\n\"\n    confirmation_text += f\"ğŸ“² Tayyor bo'lgach sizga yuboriladi (2-3 daqiqa)\\n\\n\"\n    confirmation_text += f\"Shu vaqt ichida botning boshqa funksiyalaridan foydalanishingiz mumkin!\"\n    \n    await message.answer(confirmation_text, reply_markup=get_main_menu())\n    \n    # Mualliflar ro'yxatini yaratish\n    authors = [{\n        'name': author_name,\n        'affiliation': field_position\n    }]\n    \n    # Agar ustoz bo'lsa, qo'shish\n    if supervisor:\n        authors.append({\n            'name': supervisor,\n            'affiliation': 'Ilmiy rahbar'\n        })\n    \n    user_data_for_ai = {\n        'topic': topic,\n        'subject': field_position.split(',')[0] if ',' in field_position else field_position,\n        'authors': authors\n    }\n    \n    # Background task yaratish\n    asyncio.create_task(\n        process_article_background(bot, telegram_id, user_data_for_ai, price, topic)\n    )\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ’° Balansim\")\nasync def balance_handler(message: Message):\n    \"\"\"Balans ko'rsatish\"\"\"\n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        return\n    \n    await message.answer(\n        f\"ğŸ’° Sizning balansingiz: {user['balance']:,} so'm\\n\\n\"\n        f\"Balansni to'ldirish uchun quyidagi tugmani bosing:\",\n        reply_markup=get_balance_buttons()\n    )\n\n@router.callback_query(F.data == \"add_balance\")\nasync def add_balance_callback(callback: CallbackQuery, state: FSMContext):\n    \"\"\"Balans to'ldirish\"\"\"\n    await callback.message.answer(\n        \"ğŸ’µ To'ldirmoqchi bo'lgan summani kiriting (so'mda):\\n\\n\"\n        \"Masalan: 50000\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_payment_amount)\n    await callback.answer()\n\n@router.message(UserStates.waiting_for_payment_amount)\nasync def process_payment_amount(message: Message, state: FSMContext):\n    \"\"\"To'lov summasini qabul qilish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    try:\n        amount = int(message.text.replace(\",\", \"\").replace(\" \", \"\"))\n        if amount < 1000:\n            await message.answer(\"âŒ Minimal summa 1,000 so'm bo'lishi kerak.\")\n            return\n        \n        await state.update_data(payment_amount=amount)\n        await message.answer(\n            f\"ğŸ’° <b>To'lov summasi: {amount:,} so'm</b>\\n\\n\"\n            f\"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\"\n            f\"ğŸ“± <b>Quyidagi kartalardan biriga to'lov qiling:</b>\\n\\n\"\n            f\"ğŸ”¹ <code>5614 6821 2364 5204</code>\\n\"\n            f\"   ğŸ’³ Uzcard\\n\\n\"\n            f\"ğŸ”¹ <code>9860 2301 0130 5897</code>\\n\"\n            f\"   ğŸ’³ Humo\\n\\n\"\n            f\"ğŸ”¹ <code>4067 0700 0846 9202</code>\\n\"\n            f\"   ğŸ’³ VISA\\n\\n\"\n            f\"ğŸ‘¤ <i>Ataullayev Saidmuhammadalixon</i>\\n\"\n            f\"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n\"\n            f\"ğŸ“¸ <b>To'lov chekini (screenshot) yuboring</b>\\n\\n\"\n            f\"âš ï¸ <i>Chek haqiqiy bo'lishi kerak!\\n\"\n            f\"Admin tekshirib, hisobingizni to'ldiradi.</i>\",\n            reply_markup=get_cancel_button(),\n            parse_mode=\"HTML\"\n        )\n        await state.set_state(UserStates.waiting_for_payment_check)\n    \n    except ValueError:\n        await message.answer(\"âŒ Iltimos, faqat raqam kiriting.\")\n\n@router.message(UserStates.waiting_for_payment_check, F.photo)\nasync def process_payment_check(message: Message, state: FSMContext, bot):\n    \"\"\"To'lov chekini qabul qilish\"\"\"\n    data = await state.get_data()\n    amount = data.get(\"payment_amount\")\n    \n    if not amount:\n        await message.answer(\"âŒ To'lov summasi topilmadi. Iltimos, qaytadan boshlang.\", reply_markup=get_main_menu())\n        await state.clear()\n        return\n    \n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        await state.clear()\n        return\n    \n    photo = message.photo[-1]\n    file_link = photo.file_id\n    \n    payment_id = db.add_payment(telegram_id, amount, file_link)\n    \n    if config.TOLOV_TASDIQLASH_CHANNEL_ID:\n        from keyboards import get_payment_confirmation\n        \n        await bot.send_photo(\n            chat_id=config.TOLOV_TASDIQLASH_CHANNEL_ID,\n            photo=photo.file_id,\n            caption=f\"\"\"ğŸ’³ To'lov tasdiqlash\n\nğŸ‘¤ Ismi: {user['full_name']}\nğŸ†” ID: {telegram_id}\nğŸ”— Username: @{user['username'] or 'mavjud emas'}\nğŸ’° Summa: {amount:,} so'm\nğŸ†” To'lov ID: {payment_id}\nğŸ•’ Sana: {datetime.now().strftime('%Y-%m-%d %H:%M')}\"\"\",\n            reply_markup=get_payment_confirmation(payment_id)\n        )\n    \n    await message.answer(\n        \"âœ… To'lov chekingiz qabul qilindi!\\n\\n\"\n        \"Admin tekshirgandan so'ng balansingiz yangilanadi.\\n\"\n        \"Bu odatda 5-30 daqiqa vaqt oladi.\",\n        reply_markup=get_main_menu()\n    )\n    \n    await state.clear()\n\n@router.message(F.text == \"ğŸ’µ Pul ishlash\")\nasync def referal_handler(message: Message):\n    \"\"\"Referal tizimi\"\"\"\n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        return\n    \n    referal_count = db.get_referal_count(telegram_id)\n    referal_bonus = int(db.get_setting(\"referal_bonus\", str(config.DEFAULT_REFERAL_BONUS)))\n    \n    bot_username = (await message.bot.get_me()).username\n    referal_link = f\"https://t.me/{bot_username}?start={user['referal_code']}\"\n    \n    await message.answer(\n        f\"ğŸ’µ Referal tizimi\\n\\n\"\n        f\"ğŸ”— Sizning referal havolangiz:\\n{referal_link}\\n\\n\"\n        f\"ğŸ‘¥ Taklif qilganlar soni: {referal_count} ta\\n\"\n        f\"ğŸ’° Har bir referal uchun: {referal_bonus:,} so'm\\n\\n\"\n        f\"ğŸ“Š Jami ishlab topganingiz: {referal_count * referal_bonus:,} so'm\\n\\n\"\n        f\"Havolani do'stlaringizga ulashing va pul ishlang! ğŸ‰\"\n    )\n\n@router.message(F.text == \"ğŸ‘¤ Profil\")\nasync def profile_handler(message: Message):\n    \"\"\"Profil ko'rsatish\"\"\"\n    telegram_id = message.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if not user:\n        await message.answer(\"âŒ Foydalanuvchi topilmadi. /start buyrug'ini yuboring.\", reply_markup=get_main_menu())\n        return\n    \n    referal_count = db.get_referal_count(telegram_id)\n    \n    await message.answer(\n        f\"ğŸ‘¤ Profil ma'lumotlari\\n\\n\"\n        f\"ğŸ†” ID: {telegram_id}\\n\"\n        f\"ğŸ‘¤ Ism: {user['full_name']}\\n\"\n        f\"ğŸ”— Username: @{user['username'] or 'mavjud emas'}\\n\"\n        f\"ğŸ’° Balans: {user['balance']:,} so'm\\n\"\n        f\"ğŸ‘¥ Referal soni: {referal_count} ta\\n\"\n        f\"ğŸ“… Ro'yxatdan o'tgan: {user['register_date']}\"\n    )\n\n@router.message(F.text == \"ğŸ Promokodlarim\")\nasync def promocode_handler(message: Message, state: FSMContext):\n    \"\"\"Promokod kiritish\"\"\"\n    await message.answer(\n        \"ğŸ Promokodni kiriting:\\n\\n\"\n        \"Promokod orqali chegirmaga ega bo'ling!\",\n        reply_markup=get_cancel_button()\n    )\n    await state.set_state(UserStates.waiting_for_promocode)\n\n@router.message(UserStates.waiting_for_promocode)\nasync def process_promocode(message: Message, state: FSMContext):\n    \"\"\"Promokodni tekshirish\"\"\"\n    if message.text == \"âŒ Bekor qilish\":\n        await state.clear()\n        await message.answer(\"Bekor qilindi.\", reply_markup=get_main_menu())\n        return\n    \n    code = message.text.strip().upper()\n    promocode = db.get_promocode(code)\n    \n    if not promocode:\n        await message.answer(\"âŒ Bunday promokod topilmadi yoki muddati tugagan.\", reply_markup=get_main_menu())\n        await state.clear()\n        return\n    \n    if promocode['expiry_date']:\n        expiry = datetime.strptime(promocode['expiry_date'], \"%Y-%m-%d\")\n        if expiry < datetime.now():\n            await message.answer(\"âŒ Promokod muddati tugagan.\", reply_markup=get_main_menu())\n            await state.clear()\n            return\n    \n    await message.answer(\n        f\"âœ… Promokod qabul qilindi!\\n\\n\"\n        f\"ğŸ Kod: {code}\\n\"\n        f\"ğŸ“ Turi: {promocode['work_type']}\\n\"\n        f\"ğŸ’° Chegirma: {promocode['discount_percent']}%\\n\\n\"\n        f\"Keyingi buyurtmangizda bu chegirma avtomatik qo'llaniladi!\",\n        reply_markup=get_main_menu()\n    )\n    \n    await state.clear()\n\n\n@router.callback_query(F.data.startswith(\"accept_service_\"))\nasync def accept_service_callback(callback: CallbackQuery, state: FSMContext):\n    \"\"\"Xizmatni qabul qilish - balans tekshiruvi\"\"\"\n    service_type = callback.data.split(\"_\")[-1]\n    telegram_id = callback.from_user.id\n    user = db.get_user(telegram_id)\n    \n    if service_type == \"kurs\":\n        price = int(db.get_setting(\"kurs_ishi_price\", \"50000\"))\n        service_name = \"Kurs ishi\"\n    else:\n        price = int(db.get_setting(\"maqola_price\", \"30000\"))\n        service_name = \"Maqola\"\n    \n    # Balans tekshiruvi\n    if user['balance'] >= price:\n        # Balans yetarli - FSM boshlash\n        await callback.answer()\n        if service_type == \"kurs\":\n            await callback.message.answer(\n                \"ğŸ“š Kurs ishi tayyorlash boshlandi!\\n\\n\"\n                \"ğŸ‘¤ F.I.Sh. (to'liq ismingiz) kiriting:\\n\\n\"\n                \"Masalan: Abdullayev Akmal Rustamovich\",\n                reply_markup=get_cancel_button()\n            )\n            await state.set_state(UserStates.waiting_for_kurs_fish)\n        else:\n            await callback.message.answer(\n                \"ğŸ“ Maqola mavzusini kiriting:\\n\\n\"\n                \"Masalan: Raqamli iqtisodiyotda blockchain texnologiyasining o'rni\",\n                reply_markup=get_cancel_button()\n            )\n            await state.set_state(UserStates.waiting_for_maqola_topic)\n    else:\n        # Balans yetarli emas\n        needed = price - user['balance']\n        await callback.answer()\n        await callback.message.answer(\n            f\"âš ï¸ **Balans yetarli emas!**\\n\\n\"\n            f\"ğŸ’° Hozirgi balans: {user['balance']:,} so'm\\n\"\n            f\"ğŸ’µ Xizmat narxi: {price:,} so'm\\n\"\n            f\"âŒ Yetmayapti: {needed:,} so'm\\n\\n\"\n            \"ğŸ“² Iltimos, hisobingizni to'ldiring:\",\n            reply_markup=get_balance_buttons(),\n            parse_mode=\"Markdown\"\n        )\n\n@router.callback_query(F.data == \"back_to_menu\")\nasync def back_to_menu_callback(callback: CallbackQuery):\n    \"\"\"Asosiy menyuga qaytish\"\"\"\n    await callback.answer()\n    await callback.message.answer(\n        \"Asosiy menyu:\",\n        reply_markup=get_main_menu()\n    )\n\n@router.callback_query(F.data.startswith(\"pdf:\"))\nasync def convert_to_pdf_callback(callback: CallbackQuery):\n    \"\"\"DOCX faylni PDF ga o'tkazish\"\"\"\n    await callback.answer(\"PDF yaratilmoqda, iltimos kuting...\")\n    \n    try:\n        # Filename olish\n        filename = callback.data.split(\"pdf:\", 1)[1]\n        \n        # To'liq yo'lni yaratish\n        file_path = os.path.join('generated_files', filename)\n        \n        if not os.path.exists(file_path):\n            await callback.message.answer(\n                \"âŒ Fayl topilmadi yoki o'chirilgan. Iltimos, qayta kurs ishi/maqola yaratib, PDF qilishni darhol bosing.\"\n            )\n            return\n        \n        # PDF fayl nomi\n        pdf_path = file_path.replace('.docx', '.pdf')\n        \n        # LibreOffice orqali PDF ga o'tkazish\n        import subprocess\n        \n        output_dir = os.path.dirname(file_path)\n        \n        # LibreOffice CLI orqali konvertatsiya\n        result = subprocess.run(\n            ['libreoffice', '--headless', '--convert-to', 'pdf', '--outdir', output_dir, file_path],\n            capture_output=True,\n            text=True,\n            timeout=60\n        )\n        \n        if result.returncode == 0 and os.path.exists(pdf_path):\n            # PDF faylni yuborish\n            pdf_file = FSInputFile(pdf_path)\n            await callback.message.answer_document(\n                document=pdf_file,\n                caption=\"ğŸ“„ PDF formatda tayyor!\\n\\nEndi telefoningizda ham muammosiz ochiladi.\"\n            )\n            \n            # PDF faylni o'chirish (joy tejash uchun)\n            try:\n                os.remove(pdf_path)\n            except:\n                pass\n        else:\n            # Agar LibreOffice ishlamasa\n            await callback.message.answer(\n                \"âŒ PDF yaratishda xatolik yuz berdi.\\n\\n\"\n                \"Iltimos, DOCX faylni kompyuteringizda Word orqali oching va \"\n                \"\\\"Save As\\\" â†’ \\\"PDF\\\" orqali PDF qiling.\"\n            )\n            logger.error(f\"PDF conversion failed: {result.stderr}\")\n    \n    except subprocess.TimeoutExpired:\n        await callback.message.answer(\n            \"âŒ PDF yaratish juda uzoq davom etdi.\\n\\n\"\n            \"Iltimos, DOCX faylni kompyuteringizda PDF qiling.\"\n        )\n    except Exception as e:\n        logger.error(f\"PDF konvertatsiya xatoligi: {e}\")\n        await callback.message.answer(\n            \"âŒ PDF yaratishda xatolik yuz berdi.\\n\\n\"\n            \"Iltimos, DOCX faylni kompyuteringizda Word orqali oching va \"\n            \"\\\"Save As\\\" â†’ \\\"PDF\\\" orqali PDF qiling.\"\n        )\n\n@router.message(F.text == \"â“ Yordam\")\nasync def help_handler(message: Message):\n    \"\"\"Yordam\"\"\"\n    help_text = \"\"\"â“ **Yordam**\n\nğŸ”¹ **Kurs ishi yozish** - Mavzuni kiriting va AI tayyorlaydi\nğŸ”¹ **Maqola yozish** - Maqola mavzusini kiriting\nğŸ”¹ **Balansim** - Hisobingizni to'ldiring va ko'ring\nğŸ”¹ **Pul ishlash** - Referal havolangizni ulashing\nğŸ”¹ **Profil** - Shaxsiy ma'lumotlaringiz\nğŸ”¹ **Promokodlarim** - Chegirmalardan foydalaning\n\nğŸ’¬ Savollaringiz bo'lsa, qo'llab-quvvatlash guruhiga qo'shiling:\"\"\"\n    \n    await message.answer(\n        help_text, \n        reply_markup=get_support_buttons(config.SUPPORT_GROUP_URL),\n        parse_mode=\"Markdown\"\n    )\n","size_bytes":33950},"replit.md":{"content":"# Telegram Bot - Kurs Ishi va Maqola Tayyorlash\n\n## Overview\n\nThis Telegram bot (@Dotsent_ai_bot) assists users in generating professional coursework and scientific articles using AI (OpenAI GPT-4o Mini). The bot features a balance system, a referral program, and promotional codes. It aims to provide a fast, affordable, and high-quality solution for academic content creation, adhering to specific formatting standards required in Uzbekistan. The project targets students and academics, offering dynamically generated, comprehensive documents.\n\n## User Preferences\n\nI want iterative development. Ask before making major changes. I prefer detailed explanations. Do not make changes to the folder `generated_files/` and the `.env` file.\n\n## System Architecture\n\nThe bot is built with `Aiogram 3.x` for Telegram Bot API interaction and `OpenAI API (GPT-4o Mini)` for content generation. It utilizes `SQLite` for database management and `python-docx` for professional DOCX formatting. `LibreOffice CLI` is used for PDF conversion. The system is designed for asynchronous (parallel) processing, allowing multiple users to receive service simultaneously through `asyncio.create_task()` for background tasks and `loop.run_in_executor()` for non-blocking OpenAI API calls.\n\n**UI/UX Decisions:**\n- Interactive inline and reply keyboards for user navigation.\n- Clear step-by-step FSM (Finite State Machine) for data collection (e.g., F.I.Sh, academic details for coursework; topic, author, supervisor for articles).\n- URL buttons for viewing sample documents and accessing support groups.\n\n**Technical Implementations & Feature Specifications:**\n\n- **AI Content Generation:**\n    - Uses `gpt-4o-mini` for cost-effectiveness and efficiency.\n    - **Coursework:** Generates 35-40 pages (~13,000-15,000 words) across 7 sections (Introduction, 3 Chapters, Conclusion, References, Appendix). Each section is a separate OpenAI request with detailed prompts for depth and length validation. Dynamic plan, table of contents, and references are AI-generated based on the topic.\n    - **Scientific Article:** Generates 7-10 pages including title page, multi-lingual abstract (Uzbek, English, Russian), keywords, Introduction, Research Methods, Results & Discussion, Conclusion, and APA-formatted references (15-20 sources).\n- **Document Formatting:**\n    - Adheres to Uzbekistan's academic standards: Times New Roman 14pt, 1.5 line spacing, specific margins (Left 30mm, Right 15mm, Top/Bottom 20mm), 1.25 cm paragraph indent.\n    - Includes dynamic title pages, table of contents, and structured sections in DOCX format.\n- **Admin Panel:** Features include mass messaging, user balance management, statistics, system settings (prices, referral bonuses), payment confirmation, and user ban/unban functionality.\n- **User Management:** Balance system, referral program, and promotional code application.\n- **File Handling:** Automated DOCX and PDF file generation and subsequent deletion to conserve server space.\n- **Error Handling:** Graceful error messages and retry mechanisms for content generation.\n\n**System Design Choices:**\n- **Modular Structure:** Code is organized into `handlers`, `utils`, `keyboards`, etc., for maintainability.\n- **Database Schema:** `SQLite` with tables for `users`, `orders`, `payments`, `promocodes`, and `settings`. Includes fields like `is_blocked` for user banning.\n- **Middleware:** `BanCheckMiddleware` to block banned users from bot interaction.\n- **Deployment:** Configured for Railway.app with `Procfile`, `requirements.txt`, and automated file cleanup.\n\n## External Dependencies\n\n- **Telegram Bot API:** Accessed via `Aiogram 3.x`.\n- **OpenAI API:** For AI-driven content generation, specifically `GPT-4o Mini`.\n- **SQLite:** Local database for storing bot data.\n- **python-docx:** Python library for creating and modifying Word (.docx) files.\n- **LibreOffice CLI:** Command-line tool used for converting DOCX files to PDF.","size_bytes":3945},"attached_assets/course_writer_1760865145478.py":{"content":"import os\nfrom openai import OpenAI\n\nOPENAI_API_KEY = os.environ.get(\"OPENAI_API_KEY\")\nopenai_client = OpenAI(api_key=OPENAI_API_KEY)\n\nasync def generate_course_work(user_data):\n    name = user_data['name']\n    university = user_data['university']\n    subject = user_data['subject']\n    topic = user_data['topic']\n    course = user_data['course']\n    \n    sections = []\n    \n    sections.append({\n        'type': 'title_page',\n        'content': generate_title_page(name, university, subject, topic, course)\n    })\n    \n    plan_content = generate_plan(subject, topic)\n    sections.append({'type': 'plan', 'content': plan_content})\n    \n    intro_content = await generate_section_with_ai(\n        f\"Kurs ishi uchun KIRISH qismini yozing. Bu qism 3-4 betni tashkil qilishi kerak (taxminan 1000-1200 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"KIRISH qismida quyidagilarni batafsil yozing:\\n\"\n        f\"1. Mavzuning dolzarbligi va ahamiyati (global va mahalliy kontekstda)\\n\"\n        f\"2. Tadqiqotning maqsadi va vazifalari (kamida 3-4 ta vazifa)\\n\"\n        f\"3. Tadqiqot ob'ekti va predmeti\\n\"\n        f\"4. Tadqiqot metodologiyasi\\n\"\n        f\"5. Ishning ilmiy va amaliy ahamiyati\\n\\n\"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang. \"\n        f\"Matn to'liq, batafsil va professional bo'lishi kerak.\",\n        max_words=1200\n    )\n    sections.append({'type': 'intro', 'content': intro_content})\n    \n    chapter1_section1 = await generate_section_with_ai(\n        f\"Kurs ishi I BOB ning 1.1-bandini yozing (4-5 bet, taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"1.1-band nazariy asoslar va tushunchalar bo'lishi kerak. \"\n        f\"Asosiy tushunchalar, ta'riflar, tarixiy rivojlanish va nazariy yondashuvlarni batafsil bayon qiling. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=1600\n    )\n    \n    chapter1_section2 = await generate_section_with_ai(\n        f\"Kurs ishi I BOB ning 1.2-bandini yozing (4-5 bet, taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"1.2-band xorijiy va mahalliy tajribalar tahlili bo'lishi kerak. \"\n        f\"Jahon va O'zbekiston amaliyotini qiyosiy tahlil qiling, adabiyotlar sharhi bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=1600\n    )\n    \n    sections.append({\n        'type': 'chapter1',\n        'title': 'I BOB. NAZARIY ASOSLAR VA ADABIYOTLAR TAHLILI',\n        'subsections': [\n            {'number': '1.1', 'title': 'Asosiy tushunchalar va nazariy asoslar', 'content': chapter1_section1},\n            {'number': '1.2', 'title': 'Xorijiy va mahalliy tajribalar tahlili', 'content': chapter1_section2}\n        ]\n    })\n    \n    chapter2_section1 = await generate_section_with_ai(\n        f\"Kurs ishi II BOB ning 2.1-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"2.1-band amaliy tahlil va holat tadqiqi bo'lishi kerak. \"\n        f\"Joriy holat tahlili, muammolar va ularning sabablari, statistik ma'lumotlar va faktlar keltirilsin. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=2000\n    )\n    \n    chapter2_section2 = await generate_section_with_ai(\n        f\"Kurs ishi II BOB ning 2.2-bandini yozing (5-6 bet, taxminan 1800-2000 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"2.2-band tendentsiyalar va rivojlanish yo'nalishlari tahlili bo'lishi kerak. \"\n        f\"Zamonaviy tendentsiyalar, texnologiyalar, innovatsiyalar va istiqbollarni batafsil tahlil qiling. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=2000\n    )\n    \n    sections.append({\n        'type': 'chapter2',\n        'title': 'II BOB. AMALIY TAHLIL VA TADQIQOT',\n        'subsections': [\n            {'number': '2.1', 'title': 'Amaliy tahlil va holat tadqiqi', 'content': chapter2_section1},\n            {'number': '2.2', 'title': 'Tendentsiyalar va rivojlanish yo\\'nalishlari', 'content': chapter2_section2}\n        ]\n    })\n    \n    chapter3_section1 = await generate_section_with_ai(\n        f\"Kurs ishi III BOB ning 3.1-bandini yozing (4-5 bet, taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"3.1-band muammolarni yechish bo'yicha takliflar bo'lishi kerak. \"\n        f\"Aniqlangan muammolarni bartaraf etish uchun aniq, amaliy takliflar bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=1600\n    )\n    \n    chapter3_section2 = await generate_section_with_ai(\n        f\"Kurs ishi III BOB ning 3.2-bandini yozing (4-5 bet, taxminan 1400-1600 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"3.2-band takomillashtirish choralari va istiqbollari bo'lishi kerak. \"\n        f\"Takliflarni amalga oshirish mexanizmlari, kutilayotgan natijalar va istiqbollarni batafsil yoritib bering. \"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=1600\n    )\n    \n    sections.append({\n        'type': 'chapter3',\n        'title': 'III BOB. TAKOMILLASHTIRISH TAKLIFLARI VA YECHIMLAR',\n        'subsections': [\n            {'number': '3.1', 'title': 'Muammolarni yechish bo\\'yicha takliflar', 'content': chapter3_section1},\n            {'number': '3.2', 'title': 'Takomillashtirish choralari va istiqbollari', 'content': chapter3_section2}\n        ]\n    })\n    \n    conclusion_content = await generate_section_with_ai(\n        f\"Kurs ishi uchun XULOSA qismini yozing (3-4 bet, taxminan 1000-1200 so'z). \"\n        f\"Fan: {subject}, Mavzu: {topic}. \"\n        f\"XULOSA qismida:\\n\"\n        f\"1. Tadqiqotning asosiy natijalari va xulosalarini umumlashtiring\\n\"\n        f\"2. Har bir bobdan kelib chiqqan xulosalarni sanab o'ting\\n\"\n        f\"3. Amaliy takliflarning qisqacha xulosasini bering\\n\"\n        f\"4. Tadqiqotning ilmiy va amaliy ahamiyatini ta'kidlang\\n\\n\"\n        f\"Matn ilmiy uslubda, uzluksiz, bir oqimda yozilsin. Paragraflar orasiga enter tashlamang.\",\n        max_words=1200\n    )\n    sections.append({'type': 'conclusion', 'content': conclusion_content})\n    \n    references_content = generate_references(subject)\n    sections.append({'type': 'references', 'content': references_content})\n    \n    appendix_content = generate_appendix()\n    sections.append({'type': 'appendix', 'content': appendix_content})\n    \n    return sections\n\nasync def generate_section_with_ai(prompt, max_words=2000):\n    try:\n        response = openai_client.chat.completions.create(\n            model=\"gpt-4.1\",\n            messages=[\n                {\n                    \"role\": \"system\",\n                    \"content\": \"Siz O'zbekiston oliygohlaridagi talabalar uchun kurs ishi yozuvchi sun'iy intellektsiz. \"\n                    \"Matnni to'liq, ilmiy uslubda, batafsil va professional darajada yozing. \"\n                    \"Matn bir oqimda, uzluksiz yozilishi kerak. Paragraflar orasiga qo'shimcha bo'shliq tashlamang. \"\n                    \"Har bir gap mantiqiy ravishda keyingi gapga bog'lanishi kerak.\"\n                },\n                {\"role\": \"user\", \"content\": prompt}\n            ],\n            max_tokens=int(max_words * 1.5)\n        )\n        return response.choices[0].message.content\n    except Exception as e:\n        print(f\"AI xatolik: {e}\")\n        return f\"[AI bilan bog'lanishda xatolik yuz berdi: {str(e)}]\"\n\ndef generate_title_page(name, university, subject, topic, course):\n    return f\"\"\"O'ZBEKISTON RESPUBLIKASI OLIY VA O'RTA MAXSUS\nTA'LIM VAZIRLIGI\n\n{university.upper()}\n\n{subject.upper()} FANIDAN\n\nKURS ISHI\n\nMavzu: {topic}\n\nBajardi: {course}-kurs talabasi\n{name}\n\nQabul qildi: __________________\n\nToshkent â€“ 2025\n\"\"\"\n\ndef generate_plan(subject, topic):\n    return \"\"\"KIRISH\n\nI BOB. NAZARIY ASOSLAR VA ADABIYOTLAR TAHLILI\n1.1. Asosiy tushunchalar va nazariy asoslar\n1.2. Xorijiy va mahalliy tajribalar tahlili\n\nII BOB. AMALIY TAHLIL VA TADQIQOT\n2.1. Amaliy tahlil va holat tadqiqi\n2.2. Tendentsiyalar va rivojlanish yo'nalishlari\n\nIII BOB. TAKOMILLASHTIRISH TAKLIFLARI VA YECHIMLAR\n3.1. Muammolarni yechish bo'yicha takliflar\n3.2. Takomillashtirish choralari va istiqbollari\n\nXULOSA\n\nFOYDALANILGAN ADABIYOTLAR RO'YXATI\n\nILOVALAR\"\"\"\n\ndef generate_references(subject):\n    return \"\"\"1. O'zbekiston Respublikasining Ta'lim to'g'risidagi Qonuni. â€“ T.: 2020.\n2. O'zbekiston Respublikasi Prezidentining Farmonlari va Qarorlari to'plami. â€“ T.: 2020-2025.\n3. Karimov I.A. Yuksak ma'naviyat â€“ yengilmas kuch. â€“ T.: Ma'naviyat, 2008.\n4. Mirziyoyev Sh.M. Tanqidiy tahlil, qat'iy tartib-intizom va shaxsiy javobgarlik â€“ har bir rahbar faoliyatining kundalik qoidasi bo'lishi kerak. â€“ T.: O'zbekiston, 2017.\n5. O'zbekiston milliy ensiklopediyasi. â€“ T.: 2000-2006.\n6. Internet manbalari: www.lex.uz, www.press-service.uz, www.ziyonet.uz\n7. Maxsus adabiyotlar va ilmiy jurnallar.\"\"\"\n\ndef generate_appendix():\n    return \"\"\"1-ILOVA\n\nJadval va diagrammalar\n\n[Bu yerda tadqiqot natijalari bo'yicha jadvallar va grafiklar joylashtiriladi]\n\n2-ILOVA\n\nQo'shimcha materiallar\n\n[Bu yerda qo'shimcha hujjatlar va materiallar joylashtiriladi]\"\"\"\n\n","size_bytes":9358},"utils/article_document_generator.py":{"content":"from docx import Document\nfrom docx.shared import Pt, Inches, Cm\nfrom docx.enum.text import WD_ALIGN_PARAGRAPH\nfrom docx.oxml.ns import qn\nfrom docx.oxml import OxmlElement\n\n\ndef create_article_document(sections, user_data, file_path):\n    \"\"\"Ilmiy maqola DOCX yaratish\"\"\"\n    doc = Document()\n    \n    # Sahifa sozlamalari\n    section = doc.sections[0]\n    section.page_height = Inches(11.69)  # A4\n    section.page_width = Inches(8.27)\n    section.left_margin = Cm(2.0)   # 20mm\n    section.right_margin = Cm(2.0)\n    section.top_margin = Cm(2.0)\n    section.bottom_margin = Cm(2.0)\n    \n    # Sahifa raqamlari\n    footer = section.footer\n    footer_para = footer.paragraphs[0]\n    footer_para.alignment = WD_ALIGN_PARAGRAPH.CENTER\n    \n    run = footer_para.add_run()\n    fldChar1 = OxmlElement('w:fldChar')\n    fldChar1.set(qn('w:fldCharType'), 'begin')\n    instrText = OxmlElement('w:instrText')\n    instrText.set(qn('xml:space'), 'preserve')\n    instrText.text = \"PAGE\"\n    fldChar2 = OxmlElement('w:fldChar')\n    fldChar2.set(qn('w:fldCharType'), 'end')\n    run._r.append(fldChar1)\n    run._r.append(instrText)\n    run._r.append(fldChar2)\n    \n    # Standart shrift\n    style = doc.styles['Normal']\n    font = style.font\n    font.name = 'Times New Roman'\n    font.size = Pt(14)\n    \n    paragraph_format = style.paragraph_format\n    paragraph_format.line_spacing = 1.5\n    paragraph_format.first_line_indent = Cm(1.25)\n    paragraph_format.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n    \n    for section_data in sections:\n        section_type = section_data['type']\n        \n        if section_type == 'title':\n            # Sarlavha va mualliflar (1-sahifa)\n            title_data = section_data['content']\n            \n            # Maqola sarlavhasi\n            p = doc.add_paragraph(title_data['title'].upper())\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(12)\n            \n            # Mualliflar\n            if title_data.get('authors'):\n                for author in title_data['authors']:\n                    p = doc.add_paragraph(author.get('name', ''))\n                    p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                    p.runs[0].font.size = Pt(14)\n                    p.runs[0].font.name = 'Times New Roman'\n                    p.paragraph_format.first_line_indent = Cm(0)\n                    p.paragraph_format.space_after = Pt(6)\n                    \n                    if author.get('affiliation'):\n                        p = doc.add_paragraph(author['affiliation'])\n                        p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                        p.runs[0].font.size = Pt(14)\n                        p.runs[0].font.name = 'Times New Roman'\n                        p.runs[0].font.italic = True\n                        p.paragraph_format.first_line_indent = Cm(0)\n                        p.paragraph_format.space_after = Pt(12)\n            \n            doc.add_page_break()\n        \n        elif section_type == 'annotations':\n            # Annotatsiyalar (3 tilda)\n            annotations = section_data['content']\n            \n            # O'zbek tilida\n            if 'uz' in annotations:\n                p = doc.add_paragraph('ANNOTATSIYA')\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                p.runs[0].font.bold = True\n                p.runs[0].font.size = Pt(14)\n                p.runs[0].font.name = 'Times New Roman'\n                p.paragraph_format.first_line_indent = Cm(0)\n                p.paragraph_format.space_after = Pt(6)\n                \n                content = annotations['uz']\n                # Kalit so'zlarni ajratish\n                if 'Kalit so\\'zlar:' in content:\n                    parts = content.split('Kalit so\\'zlar:')\n                    # Annotatsiya matni\n                    p = doc.add_paragraph(parts[0].strip())\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.space_after = Pt(6)\n                    # Kalit so'zlar\n                    p = doc.add_paragraph()\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.first_line_indent = Cm(1.25)\n                    run = p.add_run('Kalit so\\'zlar: ')\n                    run.font.bold = True\n                    run.font.size = Pt(14)\n                    p.add_run(parts[1].strip())\n                else:\n                    p = doc.add_paragraph(content)\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                \n                doc.add_paragraph()\n            \n            # Ingliz tilida\n            if 'en' in annotations:\n                p = doc.add_paragraph('ABSTRACT')\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                p.runs[0].font.bold = True\n                p.runs[0].font.size = Pt(14)\n                p.runs[0].font.name = 'Times New Roman'\n                p.paragraph_format.first_line_indent = Cm(0)\n                p.paragraph_format.space_after = Pt(6)\n                \n                content = annotations['en']\n                # Keywords ajratish\n                if 'Keywords:' in content:\n                    parts = content.split('Keywords:')\n                    # Abstract matni\n                    p = doc.add_paragraph(parts[0].strip())\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.space_after = Pt(6)\n                    # Keywords\n                    p = doc.add_paragraph()\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.first_line_indent = Cm(1.25)\n                    run = p.add_run('Keywords: ')\n                    run.font.bold = True\n                    run.font.size = Pt(14)\n                    p.add_run(parts[1].strip())\n                else:\n                    p = doc.add_paragraph(content)\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                \n                doc.add_paragraph()\n            \n            # Rus tilida\n            if 'ru' in annotations:\n                p = doc.add_paragraph('ĞĞĞĞĞ¢ĞĞ¦Ğ˜Ğ¯')\n                p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n                p.runs[0].font.bold = True\n                p.runs[0].font.size = Pt(14)\n                p.runs[0].font.name = 'Times New Roman'\n                p.paragraph_format.first_line_indent = Cm(0)\n                p.paragraph_format.space_after = Pt(6)\n                \n                content = annotations['ru']\n                # ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ° ajratish\n                if 'ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°:' in content:\n                    parts = content.split('ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°:')\n                    # ĞĞ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ matni\n                    p = doc.add_paragraph(parts[0].strip())\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.space_after = Pt(6)\n                    # ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°\n                    p = doc.add_paragraph()\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                    p.paragraph_format.first_line_indent = Cm(1.25)\n                    run = p.add_run('ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°: ')\n                    run.font.bold = True\n                    run.font.size = Pt(14)\n                    p.add_run(parts[1].strip())\n                else:\n                    p = doc.add_paragraph(content)\n                    p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n                \n                doc.add_paragraph()\n        \n        elif section_type == 'kirish':\n            p = doc.add_paragraph('KIRISH')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(6)\n            \n            content = section_data['content']\n            # Matnni uzluksiz yozish\n            clean_text = ' '.join(content.split())\n            p = doc.add_paragraph(clean_text)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            \n            doc.add_page_break()\n        \n        elif section_type == 'methods':\n            p = doc.add_paragraph('TADQIQOT USLUBLARI')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(6)\n            \n            content = section_data['content']\n            # Matnni uzluksiz yozish\n            clean_text = ' '.join(content.split())\n            p = doc.add_paragraph(clean_text)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            \n            doc.add_page_break()\n        \n        elif section_type == 'results':\n            p = doc.add_paragraph('NATIJALAR VA MUHOKAMA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(6)\n            \n            content = section_data['content']\n            # Matnni uzluksiz yozish\n            clean_text = ' '.join(content.split())\n            p = doc.add_paragraph(clean_text)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            \n            doc.add_page_break()\n        \n        elif section_type == 'conclusion':\n            p = doc.add_paragraph('XULOSA')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(6)\n            \n            content = section_data['content']\n            # Matnni uzluksiz yozish\n            clean_text = ' '.join(content.split())\n            p = doc.add_paragraph(clean_text)\n            p.alignment = WD_ALIGN_PARAGRAPH.JUSTIFY\n            \n            doc.add_page_break()\n        \n        elif section_type == 'references':\n            p = doc.add_paragraph('FOYDALANILGAN ADABIYOTLAR')\n            p.alignment = WD_ALIGN_PARAGRAPH.CENTER\n            p.runs[0].font.bold = True\n            p.runs[0].font.size = Pt(14)\n            p.runs[0].font.name = 'Times New Roman'\n            p.paragraph_format.first_line_indent = Cm(0)\n            p.paragraph_format.space_after = Pt(12)\n            \n            content = section_data['content']\n            lines = content.split('\\n')\n            for line in lines:\n                if line.strip():\n                    p = doc.add_paragraph(line.strip())\n                    p.alignment = WD_ALIGN_PARAGRAPH.LEFT\n                    p.paragraph_format.first_line_indent = Cm(0)\n                    p.paragraph_format.space_after = Pt(6)\n    \n    doc.save(file_path)\n    return file_path\n","size_bytes":11327},"README_RAILWAY.md":{"content":"# Railway.app ga Deploy qilish qo'llanmasi\n\n## ğŸ“‹ Talab qilinadigan fayllar\n\nLoyihada quyidagi fayllar mavjud:\n- âœ… `main.py` - Botning asosiy fayli\n- âœ… `requirements.txt` - Python dependencies\n- âœ… `Procfile` - Railway uchun start command\n- âœ… `.python-version` - Python versiyasi (3.11)\n- âœ… `runtime.txt` - Python runtime\n- âœ… `.gitignore` - Git ignore fayli\n\n---\n\n## ğŸš€ Railway ga deploy qilish\n\n### 1-qadam: GitHub ga upload qilish\n\n```bash\n# Git repository yaratish\ngit init\ngit add .\ngit commit -m \"Initial commit - Telegram Bot\"\ngit branch -M main\n\n# GitHub repository yaratib, unga push qilish\ngit remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git\ngit push -u origin main\n```\n\n### 2-qadam: Railway.app ga kirish\n\n1. [Railway.app](https://railway.app) ga boring\n2. **Sign up** yoki **Login** qiling (GitHub orqali)\n3. **New Project** tugmasini bosing\n4. **Deploy from GitHub repo** ni tanlang\n5. Repository'ingizni tanlang\n\n### 3-qadam: Environment Variables qo'shish\n\nRailway dashboard â†’ **Variables** â†’ **+ New Variable**\n\nQuyidagi barcha secret'larni qo'shing:\n\n```bash\nBOT_TOKEN=your_bot_token_here\nOPENAI_API_KEY=your_openai_key_here\nADMIN_ID=your_telegram_id\nKURS_ISHLARI_CHANNEL_ID=your_channel_id\nMAQOLALAR_CHANNEL_ID=your_channel_id\nTOLOV_TASDIQLASH_CHANNEL_ID=your_channel_id\nKURS_ISHI_SAMPLE_URL=https://t.me/your_channel/123\nMAQOLA_SAMPLE_URL=https://t.me/your_channel/456\nSUPPORT_GROUP_URL=https://t.me/your_support_group\n```\n\n**Muhim:**\n- Har bir qiymatni to'g'ri kiriting\n- Channel ID'lar `-100` bilan boshlanishi kerak\n- URL'lar to'liq havola bo'lishi kerak\n\n### 4-qadam: Deploy qilish\n\n1. Railway avtomatik deploy boshlaydi\n2. **Deployments** tab'da build loglarini ko'ring\n3. âœ… \"Build successful\" ko'rsatilsa - tayyor!\n\n### 5-qadam: Botni tekshirish\n\n1. Telegram'da botingizga boring\n2. `/start` buyrug'ini yuboring\n3. Barcha tugmalar ishlayotganini tekshiring\n\n---\n\n## ğŸ“Š Railway Monitoring\n\n### Loglarni ko'rish:\nRailway Dashboard â†’ Your Project â†’ **Deployments** â†’ **View Logs**\n\n### Bot qayta ishga tushirish:\nRailway Dashboard â†’ Your Project â†’ **Settings** â†’ **Restart**\n\n### Bot to'xtatish:\nRailway Dashboard â†’ Your Project â†’ **Settings** â†’ **Delete Service**\n\n---\n\n## ğŸ’° Narxlar (2024)\n\n- **Hobby Plan**: $5/oyiga\n  - Har oy $5 bepul kredit beriladi\n  - Kichik botlar uchun yetarli\n  - Cheksiz runtime\n- To'lov kartasini qo'shish yoki $5 oldindan to'lash kerak\n\n---\n\n## ğŸ”§ Muammolarni hal qilish\n\n### Bot ishlamayapti?\n1. Railway loglarini tekshiring\n2. Environment variables to'g'ri kiritilganini tekshiring\n3. Bot token hali ham faol ekanini tekshiring (@BotFather)\n\n### Database xatoligi?\nRailway `bot_database.db` ni avtomatik yaratadi, lekin...\n- Agar PostgreSQL kerak bo'lsa: Railway â†’ **+ New** â†’ **Database** â†’ **PostgreSQL**\n\n### Fayl tizimi xatoligi?\nRailway'da har bir deploy yangi container yaratadi, shuning uchun:\n- âœ… Fayllar yuborilgandan keyin **avtomatik o'chiriladi** (kod ichida)\n- âœ… SQLite database saqlanadi (Railway volume'da)\n\n### Out of memory?\n- Railway default: 512MB RAM\n- Settings â†’ **Resources** â†’ ko'proq RAM ajratish (pullik)\n\n---\n\n## âœ… Deploy checklist\n\n- [ ] GitHub'ga push qilindi\n- [ ] Railway project yaratildi\n- [ ] Barcha environment variables qo'shildi\n- [ ] Deploy muvaffaqiyatli bo'ldi\n- [ ] Bot Telegram'da ishlayapti\n- [ ] Kurs ishi va maqola yaratish test qilindi\n- [ ] PDF konvertatsiya ishlayapti\n- [ ] Admin panel ishlayapti\n\n---\n\n## ğŸ”— Foydali havolalar\n\n- **Railway Dashboard**: https://railway.app/dashboard\n- **Railway Docs**: https://docs.railway.app\n- **Telegram Bot API**: https://core.telegram.org/bots/api\n- **OpenAI API**: https://platform.openai.com\n\n---\n\n## ğŸ‰ Tayyor!\n\nBotingiz endi Railway'da 24/7 ishlaydi!\n\nHar qanday savol bo'lsa, qo'llab-quvvatlash guruhiga murojaat qiling.\n","size_bytes":3849}},"version":2}